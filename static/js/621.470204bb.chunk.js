"use strict";(self.webpackChunkpoe_idol_grid=self.webpackChunkpoe_idol_grid||[]).push([[621],{621:(e,t,s)=>{s.r(t),s.d(t,{default:()=>It});var r=s(43),i=s(335),n=s(537),l=s(964),a=s(734);const o=[{name:"Minor",width:1,height:1},{name:"Kamasan",width:1,height:2},{name:"Totemic",width:1,height:3},{name:"Noble",width:2,height:1},{name:"Conqueror",width:2,height:2},{name:"Burial",width:3,height:1}],d=["minor_idol_mods.json","kamasan_noble_idol_mods.json","burial_totemic_idol_mods.json","conqueror_idol_mods.json"];var c=s(932);const u="poe-idol-grid",m="poe-idol-inventory",f=e=>{try{return localStorage.setItem(u,JSON.stringify(e)),!0}catch(t){return console.error("Failed to save grid:",t),!1}},x=e=>{try{return localStorage.setItem(m,JSON.stringify(e)),!0}catch(t){return console.error("Failed to save inventory:",t),!1}},h={Minor:"m",Kamasan:"k",Totemic:"t",Noble:"n",Conqueror:"c",Burial:"b"},p=Object.entries(h).reduce(((e,t)=>{let[s,r]=t;return{...e,[r]:s}}),{}),g=(e,t)=>{const s=new Map(t.map(((e,t)=>[e.id,t]))),r=[],i=new Set;for(let n=0;n<e.length;n++)for(let t=0;t<e[n].length;t++){const l=e[n][t];if(l){const e=l.position||{row:n,col:t};if(e.row===n&&e.col===t){const e=s.get(l.id);r.push([e,n,t]),i.add(e)}}}return{g:r,v:t.map(((e,t)=>{var s;const r=[t,(s=e.type,h[s]||"x"),i.has(t)?1:0];if(e.isUnique){var n;r.push(1),r.push(e.uniqueName||e.name),r.push((null===(n=e.uniqueModifiers)||void 0===n?void 0:n.map((e=>e.Mod)))||[])}else{var l,a;r.push(0);const t=(null===(l=e.prefixes)||void 0===l?void 0:l.filter((e=>e.id)).map((e=>e.id)))||[],s=(null===(a=e.suffixes)||void 0===a?void 0:a.filter((e=>e.id)).map((e=>e.id)))||[];r.push(t),r.push(s)}return r}))}},b=(e,t,s)=>{if(!t||!e)return null;if(s){const r=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();if(t.prefixes[r]){const s=t.prefixes[r].find((t=>t.id===e));if(s)return{...s}}if(t.suffixes[r]){const s=t.suffixes[r].find((t=>t.id===e));if(s)return{...s}}}for(const r in t.prefixes){const s=t.prefixes[r].find((t=>t.id===e));if(s)return{...s}}for(const r in t.suffixes){const s=t.suffixes[r].find((t=>t.id===e));if(s)return{...s}}return null},v={Minor:{width:1,height:1},Kamasan:{width:1,height:2},Totemic:{width:1,height:3},Noble:{width:2,height:1},Conqueror:{width:2,height:2},Burial:{width:3,height:1}},y=(e,t)=>{if(null===e||void 0===e||!e.v||null===e||void 0===e||!e.g)return null;const s=e.v.map((e=>{const[s,r,i,n]=e,l=p[r]||"Unknown";const a=`idol-${Date.now()}-${s}`;if(1===n){const t=e[4],s=e[5]||[];return{id:a,type:l,name:t,uniqueName:t,isPlaced:1===i,isUnique:!0,uniqueModifiers:s.map((e=>({Mod:e,Name:"Unique",Code:`Unique-${Date.now()}-${Math.random()}`}))),prefixes:[],suffixes:[]}}{const s=e[4]||[],r=e[5]||[],n=s.map((e=>b(e,t,l))).filter(Boolean),o=r.map((e=>b(e,t,l))).filter(Boolean),d=((e,t,s,r)=>{if(r)return`Unique ${e} Idol`;let i=e;return(null===t||void 0===t?void 0:t.length)>0&&(i=`${t[0].Name} ${i}`),(null===s||void 0===s?void 0:s.length)>0&&(i=`${i} ${s[0].Name}`),i})(l,n,o,!1);return{id:a,type:l,name:d,isPlaced:1===i,isUnique:!1,prefixes:n,suffixes:o}}})),r=Array(7).fill().map((()=>Array(6).fill(null)));for(const[i,n,l]of e.g){const e=s[i];if(!e)continue;const{width:t,height:a}=v[e.type]||{width:1,height:1};e.isPlaced=!0;for(let s=n;s<n+a;s++)for(let i=l;i<l+t;i++)s<r.length&&i<r[0].length&&(r[s][i]={...e,position:{row:n,col:l}})}return{gridState:r,inventory:s}},j=(e,t)=>{try{const s=g(e,t),r=JSON.stringify(s),i=(e=>{const t=e.reduce(((e,t)=>e+String.fromCharCode(t)),"");return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})(c.Ay.deflate(r,{level:9})),n=new URL(window.location.href);return n.searchParams.set("share",i),n.toString()}catch(s){return console.error("Failed to generate share URL:",s),window.location.href}},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!t){if(t=new URL(window.location.href).searchParams.get("share"),!t)return null}const s=(e=>{const t=e.replace(/-/g,"+").replace(/_/g,"/"),s=t.length%4,r=s?t+"=".repeat(4-s):t,i=atob(r),n=new Uint8Array(i.length);for(let l=0;l<i.length;l++)n[l]=i.charCodeAt(l);return n})(t),r=c.Ay.inflate(s,{to:"string"}),i=JSON.parse(r);return y(i,e)}catch(s){return console.error("Failed to extract shared data:",s),null}};var N=s(536),C=s.n(N);const k=new Set(["0,0","2,1","2,4","3,1","3,2","3,3","3,4","4,1","4,4","6,5"]),M=(e,t)=>k.has(`${e},${t}`),S=(e,t,s,r,i)=>{const n=C().cloneDeep(e),l=i.find((e=>e.name===t.type));if(!l)return n;const a={...t,position:{row:s,col:r}};for(let o=s;o<s+l.height;o++)for(let e=r;e<r+l.width;e++)n[o][e]=a;return n},T=e=>{let t=0;for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)null===e[s][r]||M(s,r)||t++;return t},I=(e,t,s,r,i)=>{const n=i.find((e=>e.name===t.type));if(!n)return{valid:!1,reason:"unknown_type"};const{width:l,height:a}=n;if(s+a>7||r+l>6)return{valid:!1,reason:"size_too_large"};for(let o=s;o<s+a;o++)for(let t=r;t<r+l;t++){if(M(o,t))return{valid:!1,reason:"blocked_cells"};if(null!==e[o][t])return{valid:!1,reason:"overlapping"}}return{valid:!0}},$=function(e,t,s){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(0===e.length)return{grid:s,placedCount:0,notPlacedCount:0,notPlacedIdols:[]};let i=r?Array(7).fill().map((()=>Array(6).fill(null))):C().cloneDeep(s),n=T(i),l=new Set,a={};for(let d=0;d<1e3;d++){const s=Array(7).fill().map((()=>Array(6).fill(null))),r=new Set,o={},d=C().shuffle([...e]);for(const e of d){let i=!1,n="no_space";for(let l=0;l<7&&!i;l++){for(let a=0;a<6&&!i;a++){const o=I(s,e,l,a,t);if(o.valid){const n=S(s,e,l,a,t);for(let e=0;e<7;e++)s[e]=[...n[e]];i=!0,r.add(e.id);break}n=o.reason}if(i)break}i||(o[e.id]=n)}const c=T(s);c>n&&(i=s,n=c,l=r,a=o)}const o=e.filter((e=>!l.has(e.id))).map((e=>({id:e.id,name:e.name,type:e.type,reason:a[e.id]||"no_space"})));return{grid:i,placedCount:l.size,notPlacedCount:o.length,notPlacedIdols:o}};new Set(["0,0","1,2","4,2","1,3","2,3","3,3","4,3","1,4","4,4","5,6"]);const L=(e,t,s)=>{if(!e)return"";const r=[];if(t.length>0){let e=t[0].Name;t[0].totalCount>1&&(e+=` (${t[0].displayCount}/${t[0].totalCount})`),r.push(e)}if(r.push(e),s.length>0){let e=s[0].Name;s[0].totalCount>1&&0===t.length&&(e+=` (${s[0].displayCount}/${s[0].totalCount})`),r.push(e)}return t.length>1&&r.push(`of ${t[1].Name}`),s.length>1&&r.push(`of ${s[1].Name}`),r.join(" ")},E=(e,t,s)=>{if(null===e||void 0===e||!e.length||!t||null===s||void 0===s||!s.length)return[];const r=e.reduce(((e,t)=>(e[t.id]?(e[t.id].count++,e[t.id].originalCount++):e[t.id]={...t,count:1,originalCount:1},e)),{}),i=Object.values(r),n=i.reduce(((e,t)=>(e[t.id]=0,e)),{}),l=[],a=s.reduce(((e,t)=>(e[t.name]=0,e)),{}),o=(e,t)=>!((e,t)=>{if(!e||!t||e.Name!==t.Name)return!1;if(!["Breach","Domination","Essence","Harbinger","Ambush","Torment"].includes(e.Name))return!1;const s={Breach:["Breaches in your Maps contain 3 additional Clasped Hands","Breaches in your Maps contain 2 additional Clasped Hands"],Domination:["Your Maps contain an additional Shrine","Your Maps contain 2 additional Shrines"],Essence:["Your Maps contain an additional Imprisoned Monster","Your Maps contain 2 additional Imprisoned Monsters"],Harbinger:["Your Maps contain an additional Harbinger","Your Maps contain 2 additional Harbingers"],Ambush:["Your Maps contain an additional Strongbox","Your Maps contain 2 additional Strongboxes"],Torment:["Your Maps are haunted by an additional Tormented Spirit","Your Maps are haunted by 2 additional Tormented Spirits"]}[e.Name];if(!s)return!1;const r=s.includes(e.Mod),i=s.includes(t.Mod);return r&&i&&e.Mod!==t.Mod})(e,t),d=()=>{const e=i.filter((e=>"prefix"===e.type&&n[e.id]<e.count)),r=i.filter((e=>"suffix"===e.type&&n[e.id]<e.count));if(0===e.length&&0===r.length)return!1;const d=((e,r)=>{const i=new Map,n=new Map;for(const a of e){const e=[];for(const r of s){var l;null!==(l=t.prefixes[r.name])&&void 0!==l&&l.some((e=>e.id===a.id))&&e.push(r.name)}e.length>0&&i.set(a.id,e)}for(const a of r){const e=[];for(const r of s){var o;null!==(o=t.suffixes[r.name])&&void 0!==o&&o.some((e=>e.id===a.id))&&e.push(r.name)}e.length>0&&n.set(a.id,e)}const d=[["Burial","Totemic"],["Noble","Kamasan"]],c=new Map;for(const[t,s]of d)c.set(t,s),c.set(s,t);const u=s.filter((t=>{const s=0===e.length||e.some((e=>{var s;return null===(s=i.get(e.id))||void 0===s?void 0:s.includes(t.name)})),l=0===r.length||r.some((e=>{var s;return null===(s=n.get(e.id))||void 0===s?void 0:s.includes(t.name)}));return s&&l})).map((e=>e.name));if(0===u.length)return null;let m=[];for(const[t,s]of d)u.includes(t)&&u.includes(s)&&[...e,...r].every((e=>{const r="prefix"===e.type?i.get(e.id):n.get(e.id);return(null===r||void 0===r?void 0:r.includes(t))&&(null===r||void 0===r?void 0:r.includes(s))}))&&m.push([t,s]);if(m.length>0){const[e,t]=m[0],r=s.find((t=>t.name===e)),i=s.find((e=>e.name===t)),n=r.width*r.height,l=i.width*i.height,o=a[e]||0,d=a[t]||0,c=o*n,u=d*l;let f;return f=c<u?e:u<c?t:0===o&&0===d?Object.values(a).reduce(((e,t)=>e+t),0)%2===0?e:t:o<=d?e:t,f}return[...u].sort(((e,t)=>{const r=s.find((t=>t.name===e)),i=s.find((e=>e.name===t));return r.width*r.height-i.width*i.height}))[0]})(e,r);if(!d){let i=!1;for(const r of e)for(const e of s){var c;if(null!==(c=t.prefixes[e.name])&&void 0!==c&&c.some((e=>e.id===r.id))){const t={id:`${Date.now()}-${Math.random()}`,type:e.name,name:L(e.name,[r],[]),prefixes:[r],suffixes:[]};n[r.id]++,a[e.name]=(a[e.name]||0)+1,l.push(t),i=!0;break}}for(const e of r)for(const r of s){var u;if(null!==(u=t.suffixes[r.name])&&void 0!==u&&u.some((t=>t.id===e.id))){const t={id:`${Date.now()}-${Math.random()}`,type:r.name,name:L(r.name,[],[e]),prefixes:[],suffixes:[e]};n[e.id]++,a[r.name]=(a[r.name]||0)+1,l.push(t),i=!0;break}}return!!i}const m=e.filter((e=>{var s;return null===(s=t.prefixes[d])||void 0===s?void 0:s.some((t=>t.id===e.id))})),f=r.filter((e=>{var s;return null===(s=t.suffixes[d])||void 0===s?void 0:s.some((t=>t.id===e.id))})),x=[];for(const t of m){if(x.length>=2)break;x.every((e=>o(e,t)))&&x.push(t)}const h=[];for(const t of f){if(h.length>=2)break;const e=h.every((e=>o(e,t))),s=x.every((e=>o(e,t)));e&&s&&h.push(t)}if(x.length+h.length>0){const e={id:`${Date.now()}-${Math.random()}`,type:d,name:L(d,x,h),prefixes:x,suffixes:h};return x.forEach((e=>{n[e.id]++})),h.forEach((e=>{n[e.id]++})),a[d]=(a[d]||0)+1,l.push(e),!0}return!1};for(;i.some((e=>n[e.id]<e.count))&&d(););return l};var q=s(579);const A=(0,r.createContext)(),P=e=>{let{children:t}=e;const[s,i]=(0,r.useState)({prefixes:{},suffixes:{}}),[n,l]=(0,r.useState)([]),[a,c]=(0,r.useState)([]),[h,p]=(0,r.useState)(Array(7).fill().map((()=>Array(6).fill(null)))),[g,b]=(0,r.useState)(!0),[v,y]=(0,r.useState)("builder"),[j,N]=(0,r.useState)(null),[C,k]=(0,r.useState)(!0),[M,S]=(0,r.useState)("");(0,r.useEffect)((()=>{(async()=>{b(!0);try{const e=await(async()=>{try{const e="/poe-idol-grid-builder",t=d.map((t=>fetch(`${e}/data/${t}`))),s=await Promise.all(t),r=s.filter((e=>!e.ok));if(r.length>0){const e=r.map((e=>e.url)).join(", ");throw new Error(`Failed to load: ${e}`)}return{mods:(e=>{const[t,s,r,i]=e;return{prefixes:{Minor:t.prefixes,Kamasan:s.prefixes,Totemic:r.prefixes,Noble:s.prefixes,Conqueror:i.prefixes,Burial:r.prefixes},suffixes:{Minor:t.suffixes,Kamasan:s.suffixes,Totemic:r.suffixes,Noble:s.suffixes,Conqueror:i.suffixes,Burial:r.suffixes}}})(await Promise.all(s.map((e=>e.json())))),types:o}}catch(e){throw console.error("Error loading idol data:",e),alert("Failed to load idol data. If you're seeing this error, please ensure data files are in the correct location and refresh the page."),e}})();i(e.mods),l(e.types);const t=w(e.mods);if(t)p(t.gridState),c(t.inventory);else{const e=(()=>{try{const e=localStorage.getItem(u);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load grid:",e),null}})(),t=(()=>{try{const e=localStorage.getItem(m);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load inventory:",e),null}})();e&&p(e),t&&c(t)}}catch(e){console.error("Failed to load idol data:",e)}finally{b(!1)}})();localStorage.getItem("hasVisitedBefore")?k(!1):(localStorage.setItem("hasVisitedBefore","true"),k(!0))}),[]);const T=(0,r.useCallback)((e=>{const t={...e,id:Date.now()+Math.random()};c((e=>{const s=[...e,t];return x(s),s}))}),[]),I=(0,r.useCallback)(((e,t)=>0===e&&0===t||2===e&&(1===t||4===t)||3===e&&(1===t||2===t||3===t||4===t)||4===e&&(1===t||4===t)||6===e&&5===t),[]),L=(0,r.useCallback)((e=>{let t=null,s=null,r=null;for(let i=0;i<h.length;i++){for(let l=0;l<h[i].length;l++){const a=h[i][l];if(a&&a.id===e){t=a,s=a.position||{row:i,col:l},r=n.find((e=>e.name===a.type));break}}if(t)break}if(t&&s&&r){const e=h.map((e=>[...e])),{width:t,height:i}=r;for(let r=s.row;r<s.row+i;r++)for(let i=s.col;i<s.col+t;i++)r>=0&&r<e.length&&i>=0&&i<e[r].length&&(e[r][i]=null);p(e),f(e)}c((t=>{const s=t.filter((t=>t.id!==e));return x(s),s}))}),[h,n]),P=(0,r.useCallback)(((e,t,s)=>{const{row:r,col:i}=s,l=n.find((e=>e.name===t.type));if(!l)return!1;const{width:a,height:o}=l;if(r+o>7||i+a>6)return!1;for(let n=r;n<r+o;n++)for(let t=i;t<i+a;t++){if(I(n,t))return!1;if(null!==e[n][t])return!1}return!0}),[n,I]),B=(0,r.useCallback)(((e,t,s)=>{const r=e.map((e=>[...e])),{row:i,col:l}=s,a=n.find((e=>e.name===t.type));if(!a)return r;const{width:o,height:d}=a;for(let n=i;n<i+d;n++)for(let e=l;e<l+o;e++)n<r.length&&e<r[n].length&&(r[n][e]={...t,position:{row:i,col:l}});return r}),[n]),U=(0,r.useCallback)(((e,t)=>{const{row:s,col:r}=t;if(!e[s]||!e[s][r])return e;const i=e[s][r],l=n.find((e=>e.name===i.type));if(!l)return e;const{width:a,height:o}=l,d=i.position||{row:s,col:r},c=e.map((e=>[...e]));for(let n=d.row;n<d.row+o&&n<e.length;n++)for(let t=d.col;t<d.col+a&&t<e[0].length;t++)n>=0&&t>=0&&(c[n][t]=null);return c}),[n]),R=(0,r.useCallback)((function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=h;if(s&&(r=U(h,s)),P(r,e,t)){const i=B(r,e,t);return p(i),f(i),s||c((t=>{const s=t.map((t=>t.id===e.id?{...t,isPlaced:!0}:t));return x(s),s})),!0}return!1}),[h,P,B,U]),D=(0,r.useCallback)((e=>{const{row:t,col:s}=e;if(!h[t]||!h[t][s])return;const r=h[t][s],i=n.find((e=>e.name===r.type));if(!i)return;const{width:l,height:a}=i,o=r.position||{row:t,col:s},d=h.map((e=>[...e]));for(let n=o.row;n<o.row+a&&n<d.length;n++)for(let e=o.col;e<o.col+l&&e<d[n].length;e++)n>=0&&e>=0&&(d[n][e]=null);p(d),f(d),c((e=>{const t=e.map((e=>e.id===r.id?{...e,isPlaced:!1}:e));return x(t),t}))}),[h,n]),O=(0,r.useCallback)((()=>{const e=Array(7).fill().map((()=>Array(6).fill(null)));p(e),f(e),c([]),x([]),N(null)}),[]),F=(0,r.useCallback)((()=>{const e=Array(7).fill().map((()=>Array(6).fill(null)));p(e),f(e),c((e=>{const t=e.filter((e=>e.isUnique));return x(t),t})),N(null)}),[]),z=(0,r.useCallback)((()=>{const e=$(a,n,h);return p(e.grid),f(e.grid),c((t=>{const s=t.map((t=>{let s=!1;e:for(let r=0;r<e.grid.length;r++)for(let i=0;i<e.grid[r].length;i++){const n=e.grid[r][i];if(n&&n.id===t.id){s=!0;break e}}return{...t,isPlaced:s}}));return x(s),s})),{placedCount:e.placedCount,notPlacedCount:e.notPlacedCount,notPlacedIdols:e.notPlacedIdols}}),[a,n,h]),G=(0,r.useCallback)((e=>{if(e&&0!==e.length)try{const t=((e,t,s,r)=>{if(null===e||void 0===e||!e.length||!t||null===s||void 0===s||!s.length)return{idols:[],placedIdols:[],grid:r||[]};const i=e.flatMap((e=>{const t=e.count||1,{count:s,...r}=e;return Array(t).fill(r)}));return{idols:E(i,t,s),placedIdols:[],grid:r}})(e,s,n,h);if(!t||!t.idols||0===t.idols.length)return void N({total:0,placed:0,notPlaced:[],modifiersRequested:e.length,success:!1,error:"Failed to generate idols. Try different modifiers."});c((s=>{const r=[...s,...t.idols.map((e=>({...e,isPlaced:!1})))],i=$(r,n,h);p(i.grid),f(i.grid);const l=r.map((e=>{let t=!1;e:for(let s=0;s<i.grid.length;s++)for(let r=0;r<i.grid[s].length;r++){const n=i.grid[s][r];if(n&&n.id===e.id){t=!0;break e}}return{...e,isPlaced:t}}));return N({total:t.idols.length,placed:i.placedCount,notPlaced:i.notPlacedIdols,modifiersRequested:e.length,success:t.idols.length>0}),x(l),l}))}catch(t){console.error("Error generating idols:",t),N({error:"An error occurred while generating idols.",success:!1})}}),[h,n,s]),_=(0,r.useCallback)((e=>{if(e)try{const t=new URL(e).searchParams.get("share");if(t){const e=w(s,t);e&&(p(e.gridState),f(e.gridState),c(e.inventory),x(e.inventory),N({total:e.inventory.length,placed:e.inventory.filter((e=>e.isPlaced)).length,success:!0,message:"Strategy loaded successfully!"}))}}catch(t){console.error("Error loading strategy:",t),N({error:"Failed to load strategy.",success:!1})}}),[s]),H=(0,r.useMemo)((()=>a.filter((e=>{if(!M)return!0;const t=M.toLowerCase();if(e.name.toLowerCase().includes(t)||e.type.toLowerCase().includes(t)||e.isUnique&&"unique".includes(t))return!0;if(e.prefixes&&e.prefixes.length>0)for(const s of e.prefixes)if(s.Name.toLowerCase().includes(t)||s.Mod.toLowerCase().includes(t))return!0;if(e.suffixes&&e.suffixes.length>0)for(const s of e.suffixes)if(s.Name.toLowerCase().includes(t)||s.Mod.toLowerCase().includes(t))return!0;if(e.isUnique&&e.uniqueModifiers&&e.uniqueModifiers.length>0)for(const s of e.uniqueModifiers)if(s.Mod.toLowerCase().includes(t))return!0;return!1}))),[a,M]),V={modData:s,idolTypes:n,inventory:a,gridState:h,isLoading:g,activeTab:v,generationResult:j,firstVisit:C,inventorySearchTerm:M,filteredInventory:H,setActiveTab:y,setGenerationResult:N,setFirstVisit:k,setInventorySearchTerm:S,handleAddIdol:T,handleRemoveIdol:L,canPlaceIdol:P,placeIdolOnGrid:B,removeIdolFromGrid:U,handlePlaceIdol:R,handleRemoveFromGrid:D,handleClearAll:O,handleClearInventoryExceptUniques:F,handleOptimizeGrid:z,handleGenerateIdols:G,handleLoadStrategy:_,isBlockedCell:I};return(0,q.jsx)(A.Provider,{value:V,children:t})},B=()=>{const{gridState:e,idolTypes:t,canPlaceIdol:s,placeIdolOnGrid:i,removeIdolFromGrid:n,handlePlaceIdol:l,handleRemoveFromGrid:a,handleOptimizeGrid:o,isBlockedCell:d}=(0,r.useContext)(A),c=(0,r.useCallback)(((e,t)=>d?d(e,t):0===e&&0===t||2===e&&(1===t||4===t)||3===e&&(1===t||2===t||3===t||4===t)||4===e&&(1===t||4===t)||6===e&&5===t),[d]),u=(0,r.useCallback)((e=>{if(!e||!e.type)return{width:1,height:1};const s=t.find((t=>t.name===e.type));return s?{width:s.width,height:s.height}:{width:1,height:1}}),[t]),m=(0,r.useCallback)(((e,s,r,i)=>{const n=t.find((e=>e.name===s.type));if(!n)return{valid:!1,reason:"unknown_type"};const{width:l,height:a}=n;if(r+a>7||i+l>6)return{valid:!1,reason:"size_too_large"};for(let t=r;t<r+a;t++)for(let s=i;s<i+l;s++){var o;if(c(t,s))return{valid:!1,reason:"blocked_cells"};if(null!==(null===(o=e[t])||void 0===o?void 0:o[s]))return{valid:!1,reason:"overlapping"}}return{valid:!0}}),[t,c]),f=(0,r.useMemo)((()=>{let t=0,s=0;const r={},i=new Set;for(let n=0;n<e.length;n++)for(let l=0;l<e[n].length;l++){const a=e[n][l];if(null!==a&&!c(n,l)){t++;const e=a.position||{row:n,col:l},o=`${e.row}-${e.col}`;if(!i.has(o)){i.add(o),s++;const e=a.type;r[e]=(r[e]||0)+1}}}return{filledCellCount:t,totalIdols:s,idolTypeCount:r}}),[e,c]);return{gridState:e,isBlockedCell:c,getIdolDimensions:u,validatePlacement:m,canPlaceIdol:s,placeIdolOnGrid:i,removeIdolFromGrid:n,handlePlaceIdol:l,handleRemoveFromGrid:a,handleOptimizeGrid:o,gridStats:f}},U={Minor:{primary:"bg-blue-900/40",secondary:"bg-blue-900/40"},Kamasan:{primary:"bg-green-900/40",secondary:"bg-green-900/40"},Totemic:{primary:"bg-yellow-900/40",secondary:"bg-yellow-900/40"},Noble:{primary:"bg-purple-900/40",secondary:"bg-purple-900/40"},Conqueror:{primary:"bg-red-900/40",secondary:"bg-red-900/40"},Burial:{primary:"bg-orange-700/40",secondary:"bg-orange-700/40"},unique:{primary:"bg-pink-600/40",secondary:"bg-pink-600/40"},default:{primary:"bg-slate-700",secondary:"bg-slate-700"}},R=e=>{let{row:t,col:s,cell:i,isPrimary:n,isBlocked:o,onPlaceIdol:d,onRemoveFromGrid:c,idolTypes:u,gridState:m,isValidPlacement:f,currentDrag:x}=e;const[h,p]=(0,r.useState)(null),{isBlockedCell:g}=B(),b=(0,r.useCallback)(((e,t,s)=>{if(!m[e]||!m[e][t])return!1;if("GRID"===(null===s||void 0===s?void 0:s.sourceType)&&null!==s&&void 0!==s&&s.sourcePosition){var r;const{row:i,col:n}=s.sourcePosition,l=null===(r=m[i])||void 0===r?void 0:r[n];if(!l)return!0;const a=u.find((e=>e.name===l.type));if(!a)return!0;const{width:o,height:d}=a;if(e>=i&&e<i+d&&t>=n&&t<n+o)return!1}return!0}),[m,u]),v=(0,r.useCallback)((e=>{if(o||i)p("invalid");else if(e.idol&&u){const r=u.find((t=>t.name===e.idol.type));if(!r)return void p("invalid");const{width:i,height:n}=r;if(t+n>7||s+i>6)return void p("invalid");for(let l=t;l<t+n;l++)for(let t=s;t<s+i;t++){if(g(l,t))return void p("invalid");if(m[l]&&m[l][t]&&b(l,t,e))return void p("invalid")}p("valid")}}),[i,o,t,s,u,m,g,b]),[{isOver:y,canDrop:j},w]=(0,l.H)({accept:"IDOL",hover:v,drop:e=>{if(o||i)return{success:!1};let r;return r="GRID"===e.sourceType&&e.sourcePosition?d(e.idol,{row:t,col:s},e.sourcePosition):d(e.idol,{row:t,col:s}),p(null),{success:r}},canDrop:()=>!o&&!i,collect:e=>({isOver:!!e.isOver(),canDrop:!!e.canDrop()})});(0,r.useEffect)((()=>{y||p(null)}),[y]);const[{isDragging:N},C]=(0,a.i)({type:"IDOL",item:()=>i&&n?{type:"IDOL",idol:i,sourceType:"GRID",sourcePosition:{row:t,col:s}}:null,canDrag:()=>i&&n,collect:e=>({isDragging:!!e.isDragging()}),end:()=>{p(null)}}),k=(0,r.useMemo)((()=>{let e="w-14 h-14 flex items-center justify-center ";if(o)return e+"bg-slate-950 border-slate-900 opacity-60";if(i){const r=i.isUnique?U.unique:U[i.type]||U.default;if(e+=n?N?`opacity-50 ${r.primary}`:y?"bg-red-700":r.primary:r.secondary,i.position){const{width:r,height:n}=u.find((e=>e.name===i.type))||{width:1,height:1},{row:l,col:a}=i.position,o=s===a+r-1,d=t===l+n-1;t===l&&(e+=" border-t border-t-white/40"),s===a&&(e+=" border-l border-l-white/40"),o&&(e+=" border-r border-r-white/40"),d&&(e+=" border-b border-b-white/40"),!o&&s<a+r-1&&(e+=" border-r border-r-black/35"),!d&&t<l+n-1&&(e+=" border-b border-b-black/35")}return e}return e+="valid"===h?"bg-green-600/70 border border-green-500":"invalid"===h?"bg-red-600/70 border border-red-500":y?j?"bg-green-600/70 border border-green-500":"bg-red-600/70 border border-red-500":f?"bg-green-700/30 border border-green-600/50":"bg-slate-800 border border-slate-700 hover:bg-slate-750",e}),[i,n,o,N,y,j,h,f,t,s,u]);return(0,q.jsx)("div",{ref:e=>{i&&n?C(e):o||w(e)},className:k,onContextMenu:e=>{e.preventDefault(),i&&c({row:t,col:s})},title:i&&n?`${i.name} (Right-click to remove)`:"",style:{transition:"none"},children:n&&i&&(0,q.jsx)("div",{className:"text-base font-bold text-white",children:i.isUnique?"U":i.type.charAt(0)})})},D=r.memo(R),O={backgroundSize:"56px 56px",backgroundImage:"\n    linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),\n    linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px)\n  ",backgroundPosition:"0 0"};function F(e){let{gridState:t,onPlaceIdol:s,onRemoveFromGrid:i,idolTypes:n}=e;const[l,a]=(0,r.useState)(null),{isBlockedCell:o}=B(),d=(0,r.useCallback)((e=>{var t;if(null!==(t=e.dataTransfer)&&void 0!==t&&t.types.includes("application/json"))try{const t=JSON.parse(e.dataTransfer.getData("application/json"));"IDOL"===t.type&&a(t.idol)}catch(s){}}),[]),c=(0,r.useCallback)((()=>{a(null)}),[]);(0,r.useEffect)((()=>(window.addEventListener("dragstart",d),window.addEventListener("dragend",c),()=>{window.removeEventListener("dragstart",d),window.removeEventListener("dragend",c)})),[d,c]);const u=(0,r.useCallback)(((e,s)=>{if(!e||!s)return!1;const{row:r,col:i}=s,l=n.find((t=>t.name===e.type));if(!l)return!1;const{width:a,height:d}=l;if(r+d>7||i+a>6)return!1;for(let n=r;n<r+d;n++)for(let e=i;e<i+a;e++)if(o(n,e)||null!==t[n][e])return!1;return!0}),[t,n,o]),m=(0,r.useMemo)((()=>{if(!l)return[];const e=[];for(let s=0;s<t.length;s++)for(let r=0;r<t[s].length;r++)u(l,{row:s,col:r})&&e.push({row:s,col:r});return e}),[l,t,u]),f=(0,r.useCallback)((()=>t.map(((e,r)=>(0,q.jsx)("div",{className:"flex",children:e.map(((e,a)=>{const d=e&&(!e.position||e.position.row===r&&e.position.col===a),c=m.some((e=>e.row===r&&e.col===a));return(0,q.jsx)(D,{row:r,col:a,cell:e,isPrimary:d,isBlocked:o(r,a),onPlaceIdol:s,onRemoveFromGrid:i,idolTypes:n,gridState:t,isValidPlacement:c&&null!==l,currentDrag:l},`cell-${r}-${a}`)}))},`row-${r}`)))),[t,m,l,s,i,n,o]);return(0,q.jsx)("div",{className:"grid-container border-2 border-indigo-600 rounded-xl p-1 bg-slate-950 inline-block shadow-sm mx-auto scale-95 minimal-scrollbar",style:O,children:f()})}const z=r.memo(F),G={primary:"bg-indigo-600 hover:bg-indigo-500 text-white",secondary:"bg-slate-800 hover:bg-slate-700 text-white",danger:"bg-red-600 hover:bg-red-500 text-white",amber:"bg-amber-600 hover:bg-amber-500 text-white",blue:"bg-blue-600 hover:bg-blue-500 text-white"},_={sm:"py-1.5 px-3 text-xs",md:"py-2 px-4 text-sm",lg:"py-2.5 px-5 text-base"},H=e=>{let{children:t,variant:s="primary",size:r="md",className:i="",disabled:n=!1,onClick:l,title:a,type:o="button",...d}=e;const c=`rounded-lg font-medium transition-colors flex items-center justify-center ${G[s]||G.primary} ${_[r]||_.md} ${n?"opacity-60 cursor-not-allowed":""} ${i}`;return(0,q.jsx)("button",{type:o,className:c,disabled:n,onClick:l,title:a,...d,children:t})},V=r.memo(H),K={no_space:"No suitable space",size_too_large:"Too large for remaining space",overlapping:"Would overlap other idols",blocked_cells:"Would cover blocked cells"};function W(e){let{onOptimize:t}=e;const[s,i]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1),[a,o]=(0,r.useState)({placedCount:0,notPlacedCount:0,notPlacedIdols:[]}),d=(0,r.useCallback)((()=>{i(!0),setTimeout((()=>{const e=t();o(e),l(!0),i(!1)}),500)}),[t]),c=(0,r.useCallback)((()=>{l(!1)}),[]),u=(0,r.useCallback)((e=>K[e]||"Could not fit in grid"),[]),m=(0,r.useMemo)((()=>n?(0,q.jsxs)("div",{className:"absolute right-0 mt-2 p-4 bg-slate-800 border border-slate-700 rounded-lg shadow-lg z-10 w-72",children:[(0,q.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,q.jsx)("h3",{className:"font-medium text-white",children:"Results"}),(0,q.jsx)("button",{onClick:c,className:"text-slate-400 hover:text-slate-200 transition-colors","aria-label":"Close results",children:"\u2715"})]}),(0,q.jsxs)("div",{className:"text-sm space-y-3",children:[(0,q.jsxs)("div",{className:"text-green-400 font-medium",children:[a.placedCount," idols placed"]}),a.notPlacedCount>0&&(0,q.jsxs)("div",{className:"bg-slate-850 p-3 rounded-lg border border-slate-700",children:[(0,q.jsxs)("div",{className:"text-yellow-400 font-medium mb-2",children:[a.notPlacedCount," couldn't be placed:"]}),(0,q.jsx)("ul",{className:"space-y-1 ml-4 list-disc text-xs text-slate-300",children:a.notPlacedIdols.map(((e,t)=>(0,q.jsxs)("li",{children:[e.name," - ",u(e.reason)]},e.id||`unplaced-${t}`)))})]})]})]}):null),[n,a,c,u]);return(0,q.jsxs)("div",{className:"relative",children:[(0,q.jsxs)(V,{variant:"primary",onClick:d,disabled:s,title:"Automatically arrange inventory idols on the grid",className:"flex items-center gap-2",children:[(0,q.jsx)(Y,{}),s?"Optimizing...":"Smart Fill Grid"]}),m]})}const Y=r.memo((()=>(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})));Y.displayName="OptimizeIcon";const J=r.memo(W),X=e=>{if(!e)return null;const t=e.toLowerCase().trim();if(/^(your maps contain|[a-z\s]+ in your maps contain)\s+(\d+)\s+additional\s+[a-z\s]+$/i.test(t)){const e=t.match(/contain\s+(\d+)\s+additional/i);if(e&&e[1])return parseInt(e[1],10)}return/^your maps contain\s+an\s+additional\s+[a-z\s]+$/i.test(t)?1:null},Z=e=>{var t,s;if(!e)return"";if(e.isUnique){const t={query:{name:e.uniqueName||e.name,type:`${e.type} Idol`,stats:[{type:"and",filters:[]}],status:{option:"online"}}};return`https://www.pathofexile.com/trade/search/Phrecia?q=${encodeURIComponent(JSON.stringify(t))}`}const r=[];if((null===(t=e.prefixes)||void 0===t?void 0:t.length)>0&&e.prefixes.forEach((e=>{if(!e.trade)return;const t=X(e.Mod);null!==t?r.push({id:e.trade,value:{min:t,max:t},disabled:!1}):r.push({id:e.trade})})),(null===(s=e.suffixes)||void 0===s?void 0:s.length)>0&&e.suffixes.forEach((e=>{if(!e.trade)return;const t=X(e.Mod);null!==t?r.push({id:e.trade,value:{min:t,max:t},disabled:!1}):r.push({id:e.trade})})),0===r.length)return"";const i={query:{type:`${e.type} Idol`,stats:[{type:"and",filters:r}],status:{option:"online"}}};return`https://www.pathofexile.com/trade/search/Phrecia?q=${encodeURIComponent(JSON.stringify(i))}`},Q=(0,r.memo)((e=>{let{idol:t,onRemoveIdol:s,compactView:i}=e;const[{isDragging:n},l]=(0,a.i)({type:"IDOL",item:{type:"IDOL",idol:t},collect:e=>({isDragging:!!e.isDragging()}),end:(e,t)=>{const s=t.getDropResult();s&&s.success}}),o=(0,r.useCallback)((e=>{e.preventDefault(),s(t.id)}),[t.id,s]),d=(0,r.useCallback)((e=>{e.stopPropagation();const s=Z(t);s&&window.open(s,"_blank")}),[t]),c=t.isUnique?"bg-gradient-to-r from-pink-700/30 to-pink-800/40":`bg-gradient-to-r ${{Minor:"from-blue-800/30 to-blue-900/40",Kamasan:"from-green-800/30 to-green-900/40",Totemic:"from-yellow-800/30 to-yellow-900/40",Noble:"from-purple-800/30 to-purple-900/40",Conqueror:"from-red-800/30 to-red-900/40",Burial:"from-orange-600/30 to-orange-700/40"}[t.type]||"from-slate-800/30 to-slate-900/40"}`,u=n?"opacity-50":"",m=(e=>{var t,s;if(!e)return!1;if(e.isUnique)return!0;const r=(null===(t=e.prefixes)||void 0===t?void 0:t.length)>0&&e.prefixes.some((e=>!!e.trade)),i=(null===(s=e.suffixes)||void 0===s?void 0:s.length)>0&&e.suffixes.some((e=>!!e.trade));return r||i})(t),f=t.isPlaced?"border-2 border-white":"border border-slate-700 border-opacity-75";return i?(0,q.jsxs)("div",{ref:l,className:`${c} p-3 rounded-lg shadow-sm mb-2 cursor-move ${u} ${f} transition-all hover:shadow-md flex justify-between items-center`,onContextMenu:o,title:"Drag to place on grid or right-click to remove",children:[(0,q.jsxs)("div",{className:"flex-grow mr-2",children:[(0,q.jsx)("h3",{className:"font-extrabold text-base text-white truncate",children:t.name}),(0,q.jsxs)("p",{className:"text-xs text-slate-400",children:[t.type," Idol"]})]}),(0,q.jsxs)("div",{className:"flex items-center space-x-1",children:[m&&(0,q.jsx)("button",{onClick:d,className:"bg-indigo-600 hover:bg-indigo-500 border border-indigo-500 text-white text-xs py-1 px-1.5 rounded transition-colors",title:"Search for similar idols on the trade site",children:"Trade"}),(0,q.jsx)("button",{onClick:()=>s(t.id),className:"text-slate-400 hover:text-slate-300 transition-colors p-1",title:"Remove idol",children:"\u2715"})]})]}):(0,q.jsxs)("div",{ref:l,className:`${c} p-6 rounded-lg shadow-sm mb-3 cursor-move ${u} ${f} transition-all hover:shadow-md`,onContextMenu:o,title:"Drag to place on grid or right-click to remove",children:[(0,q.jsxs)("div",{className:"flex justify-between items-start",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"font-extrabold text-base text-white",children:t.name}),(0,q.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:[t.type," Idol"]})]}),(0,q.jsxs)("div",{className:"flex items-center space-x-2",children:[m&&(0,q.jsx)("button",{onClick:d,className:"bg-indigo-600 hover:bg-indigo-500 border border-indigo-500 text-white text-xs py-1 px-2 rounded transition-colors",title:"Search for similar idols on the trade site",children:"Trade"}),(0,q.jsx)("button",{onClick:()=>s(t.id),className:"text-slate-400 hover:text-slate-300 transition-colors",title:"Remove idol",children:"\u2715"})]})]}),(0,q.jsxs)("div",{className:"mt-4 space-y-3",children:[t.prefixes&&t.prefixes.length>0&&(0,q.jsxs)("div",{children:[(0,q.jsx)("h4",{className:"text-xs font-medium text-blue-400",children:"Prefixes:"}),(0,q.jsx)("ul",{className:"text-[11px] space-y-1 mt-1",children:t.prefixes.map(((e,t)=>(0,q.jsx)("li",{className:"text-slate-300",children:e.Mod},`prefix-${t}`)))})]}),t.suffixes&&t.suffixes.length>0&&(0,q.jsxs)("div",{children:[(0,q.jsx)("h4",{className:"text-xs font-medium text-green-400",children:"Suffixes:"}),(0,q.jsx)("ul",{className:"text-[11px] space-y-1 mt-1",children:t.suffixes.map(((e,t)=>(0,q.jsx)("li",{className:"text-slate-300",children:e.Mod},`suffix-${t}`)))})]}),t.isUnique&&t.uniqueModifiers&&t.uniqueModifiers.length>0&&(0,q.jsxs)("div",{children:[(0,q.jsx)("h4",{className:"text-xs font-medium text-pink-400 border-l-4 border-pink-400 pl-2 mb-2",children:"Unique Modifiers:"}),(0,q.jsx)("ul",{className:"text-[11px] space-y-1 mt-1",children:t.uniqueModifiers.map(((e,t)=>(0,q.jsx)("li",{className:"text-slate-300",children:e.Mod},`unique-${t}`)))})]})]})]})}));Q.displayName="IdolItem";const ee=()=>(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,q.jsx)("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"})}),te=()=>(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,q.jsx)("path",{d:"M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),se=()=>(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),re=e=>{let{inventory:t,onRemoveIdol:s}=e;const[i,n]=(0,r.useState)(!1),l=(0,r.useCallback)((()=>{n((e=>!e))}),[]),a=0===t.length;return(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsx)("div",{className:"flex justify-between items-center",children:(0,q.jsx)("button",{onClick:l,className:"bg-slate-800 hover:bg-slate-700 text-amber-400 hover:text-amber-300 p-1.5 rounded-md transition-colors",title:i?"Switch to detailed view":"Switch to compact view",children:i?(0,q.jsx)(ee,{}):(0,q.jsx)(te,{})})}),(0,q.jsx)("div",{className:"max-h-96 overflow-y-auto pr-1 minimal-scrollbar",children:a?(0,q.jsxs)("div",{className:"bg-slate-800/50 rounded-xl p-6 text-center border border-slate-700/50",children:[(0,q.jsx)("div",{className:"flex justify-center mb-4",children:(0,q.jsx)(se,{})}),(0,q.jsx)("p",{className:"text-slate-300 text-base mb-5",children:"No idols in inventory."})]}):(0,q.jsx)("div",{children:t.map((e=>(0,q.jsx)(Q,{idol:e,onRemoveIdol:s,compactView:i},e.id)))})})]})},ie=(0,r.memo)(re),ne=e=>{let{children:t,title:s,className:r="",headerRight:i,...n}=e;return(0,q.jsxs)("div",{className:`bg-slate-900 p-6 rounded-xl shadow-sm ${r}`,...n,children:[(s||i)&&(0,q.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[s&&(0,q.jsx)("h2",{className:"text-xl font-bold text-white",children:s}),i&&(0,q.jsx)("div",{children:i})]}),t]})},le=r.memo(ne),ae=[{type:"plusChance",regex:/\+(\d+(?:\.\d+)?)%\s+chance/i},{type:"haveChance",regex:/have\s+(\d+(?:\.\d+)?)%\s+(?:increased\s+)?chance/i},{type:"increased",regex:/(\d+(?:\.\d+)?)%\s+increased/i},{type:"more",regex:/(\d+(?:\.\d+)?)%\s+more/i},{type:"reduced",regex:/(\d+(?:\.\d+)?)%\s+reduced/i},{type:"faster",regex:/(\d+(?:\.\d+)?)%\s+faster/i},{type:"slower",regex:/(\d+(?:\.\d+)?)%\s+slower/i},{type:"additional",regex:/additional/i},{type:"numeric",regex:/(\d+(?:\.\d+)?)/}],oe=[{regex:/(\d+(?:\.\d+)?)%/g,replace:"PERCENTAGE"},{regex:/\+(\d+(?:\.\d+)?)%/g,replace:"+PERCENTAGE"},{regex:/\+(\d+(?:\.\d+)?)\b(?!%)/g,replace:"+NUMBER"},{regex:/(\d+(?:\.\d+)?)\s+additional/g,replace:"NUMBER additional"},{regex:/lasts\s+(\d+(?:\.\d+)?)\s+additional\s+seconds/g,replace:"lasts NUMBER additional seconds"},{regex:/have\s+(?:a\s+)?(\d+(?:\.\d+)?)%\s+(?:increased\s+)?chance/g,replace:"have PERCENTAGE chance"},{regex:/(\d+(?:\.\d+)?)%\s+chance/g,replace:"PERCENTAGE chance"},{regex:/(\d+(?:\.\d+)?)\s+(increased|more|reduced|faster|slower)/g,replace:"NUMBER $2"},{regex:/contain\s+(\d+(?:\.\d+)?)\s+additional/g,replace:"contain NUMBER additional"},{regex:/spawn\s+with\s+(?:an\s+)?(?:additional\s+)?(\d+(?:\.\d+)?)%\s+of\s+Life\s+missing/g,replace:"spawn with PERCENTAGE of Life missing"}],de=[/^Your Maps have \+\d/,/^Your Maps have \d+%/,/^Your Maps contain/,/^Your Maps are/,/^Your Maps which contain/,/Final Map Boss/,/Map Bosses? (has|have)/,/increased Maps found/,/increased Pack size/,/increased effect of Explicit Modifiers/,/\d+% chance for your Maps/,/\+\d+% chance to grant/],ce=[/Abyssal Troves/,/Expeditions in your Maps/,/(Blight|Delirium|Legion|Ultimatum) (Monsters|Encounters|Rewards|Bosses) in your Maps/,/Strongboxes (in|contained in) your Maps/,/Blight Towers in your Maps/,/Breaches in your Maps/,/Shrines in your Maps/,/Ritual Altars in your Maps/,/Immortal Syndicate Members in your Maps/,/Plants Harvested in your Maps/,/Oils found in your Maps/],ue=e=>{if(!e)return{type:"unstackable",value:null,fullText:""};for(const{type:s,regex:r}of ae){const i=e.match(r);var t;if(i)return{type:s,value:"additional"!==s?parseFloat(i[1]):null!==(t=e.match(/(\d+)/))&&void 0!==t&&t[1]?parseFloat(e.match(/(\d+)/)[1]):1,fullText:e}}return{type:"unstackable",value:null,fullText:e}},me=(e,t)=>{if(!e||!t)return!1;const s=e=>e.replace(/\s+/g," ").trim(),r=s(e).replace(/[\u2013\u2014\u2212]/g,"-"),i=s(t).replace(/[\u2013\u2014\u2212]/g,"-");if(r===i)return!0;if(r.replace(/\b(?:an|a|1|one)\s+additional\b/g,"NUMBER additional")===i.replace(/\b(?:an|a|1|one)\s+additional\b/g,"NUMBER additional"))return!0;for(const{regex:n,replace:l}of oe){if(r.replace(n,l)===i.replace(n,l))return!0}return!(r.replace(/\d+(?:\.\d+)?/g,"NUMBER")!==i.replace(/\d+(?:\.\d+)?/g,"NUMBER")||!((e,t)=>{const s=e.replace(/\d+(?:\.\d+)?/g,""),r=t.replace(/\d+(?:\.\d+)?/g,"");if(s===r)return!0;if(s.length>15&&r.length>15){const e=Math.min(s.length,r.length),t=Math.floor(.8*e),i=s.substring(0,t),n=r.substring(0,t);return s.includes(n)||r.includes(i)}return!1})(r,i))};function fe(e){if(!e)return"suffix";for(const t of de)if(t.test(e))return"prefix";for(const t of ce)if(t.test(e))return"suffix";return e.includes("Your Maps have")&&!e.includes("in your Maps have")?"prefix":(e.includes(" in your Maps"),"suffix")}function xe(e){let{onClose:t,availableStrategies:s,selectedStrategies:i,setSelectedStrategies:n,includeUniques:l,setIncludeUniques:a,exportText:o}=e;const[d,c]=(0,r.useState)(!1),u=e=>{n((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))};return(0,q.jsx)("div",{className:"fixed inset-0 bg-slate-950 bg-opacity-80 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,q.jsxs)("div",{className:"bg-slate-900 rounded-xl p-6 max-w-lg w-full shadow-lg border border-slate-800",children:[(0,q.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,q.jsx)("h2",{className:"text-xl font-bold text-white",children:"Export Modifiers"}),(0,q.jsx)("button",{onClick:t,className:"text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:"\u2715"})]}),(0,q.jsxs)("div",{className:"mb-6",children:[(0,q.jsx)("label",{className:"block mb-3 text-base font-medium text-slate-300",children:"Select Strategy Type(s)"}),(0,q.jsx)("div",{className:"grid grid-cols-3 gap-2 mb-6",children:0===s.length?(0,q.jsx)("div",{className:"col-span-3 text-center text-slate-400 py-2",children:"No strategy-specific modifiers detected"}):s.map((e=>(0,q.jsx)("div",{onClick:()=>u(e),className:`cursor-pointer p-2 rounded-md text-center text-sm ${i.includes(e)?"bg-indigo-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"} transition-colors`,role:"checkbox","aria-checked":i.includes(e),tabIndex:0,onKeyPress:t=>{"Enter"!==t.key&&" "!==t.key||u(e)},children:e},e)))}),(0,q.jsxs)("div",{className:"flex items-center mb-6",children:[(0,q.jsx)("input",{type:"checkbox",id:"includeUniques",checked:l,onChange:e=>a(e.target.checked),className:"mr-2 h-4 w-4 rounded border-slate-700 bg-slate-800 text-indigo-600 focus:ring-indigo-500 focus:ring-opacity-50 focus:ring-offset-0 transition-colors cursor-pointer"}),(0,q.jsx)("label",{htmlFor:"includeUniques",className:"text-sm text-slate-300 hover:text-slate-200 transition-colors cursor-pointer select-none",children:"Include Unique(s)"})]})]}),(0,q.jsx)("div",{className:"bg-slate-800 p-4 rounded-lg max-h-60 overflow-y-auto font-mono text-sm text-slate-300 mb-6",children:(0,q.jsx)("pre",{children:o})}),(0,q.jsx)("div",{className:"flex justify-end",children:(0,q.jsx)(V,{onClick:()=>{navigator.clipboard.writeText(o).then((()=>{c(!0),setTimeout((()=>c(!1)),2e3)}))},variant:d?"primary":"amber",children:d?"Copied!":"Copy Text"})})]})})}const he=(0,r.memo)(xe);function pe(e){let{name:t,modifiers:s}=e;return Array.isArray(s)&&0!==s.length?(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsx)("h3",{className:"font-semibold text-base text-amber-400 border-l-4 border-amber-400 pl-2 mb-3",children:t}),(0,q.jsx)("ul",{className:"space-y-2 minimal-scrollbar",children:s.map(((e,t)=>{if(!e)return null;const s=e.mod||e.Mod;if(!s)return null;const r="prefix"===e.type?"text-blue-200":"suffix"===e.type?"text-green-200":"text-pink-200";return(0,q.jsxs)("li",{className:"flex justify-between text-sm py-1 hover:bg-slate-800/30 px-2 rounded transition-colors",children:[(0,q.jsx)("span",{className:`text-slate-200 ${r}`,children:s}),e.count>1&&(0,q.jsxs)("span",{className:"text-slate-400 ml-2 font-medium",children:["(",e.count,"\xd7)"]})]},t)}))})]}):null}const ge=r.memo(pe),be=(0,r.memo)((e=>{let{mod:t,count:s}=e;const r="prefix"===t.type?"text-blue-200":"suffix"===t.type?"text-green-200":"text-pink-200",i=t.mod||t.Mod;return(0,q.jsxs)("li",{className:"flex justify-between text-sm py-1 hover:bg-slate-800/30 px-2 rounded transition-colors",children:[(0,q.jsx)("span",{className:`text-slate-200 ${r}`,children:i}),s>1&&(0,q.jsxs)("span",{className:"text-slate-400 ml-2 font-medium",children:["(",s,"\xd7)"]})]})}));be.displayName="ModifierItem";function ve(){const{gridState:e}=(0,r.useContext)(A),[t,s]=(0,r.useState)(!1),[i,n]=(0,r.useState)([]),[l,a]=(0,r.useState)(!1),o=(0,r.useMemo)((()=>Array.isArray(e)?(e=>{if(!e||!Array.isArray(e))return[];const t=[],s=new Set,r=[];for(let l=0;l<e.length;l++)for(let n=0;n<e[l].length;n++){const a=e[l][n];if(!a)continue;const o=a.position||{row:l,col:n},d=`${o.row}-${o.col}`;var i;s.has(d)||(s.add(d),a.isUnique&&a.uniqueModifiers?(r.push({name:a.name,position:o,modCount:null===(i=a.uniqueModifiers)||void 0===i?void 0:i.length,mods:a.uniqueModifiers}),a.uniqueModifiers.forEach((e=>{e&&e.Mod?t.push({...e,isUnique:!0,name:"Unique",type:"unique"}):console.warn("Invalid mod found in unique idol:",e)}))):(a.prefixes&&a.prefixes.forEach((e=>{e&&e.Mod&&t.push({...e,name:e.Name||"Unknown",type:"prefix"})})),a.suffixes&&a.suffixes.forEach((e=>{e&&e.Mod&&t.push({...e,name:e.Name||"Unknown",type:"suffix"})}))))}const n={};return t.forEach((e=>{if(!e||!e.Mod)return void console.warn("Invalid modifier found:",e);const t=(s=e.Mod)?s.match(/Tier \d+-\d+ Maps found/)?"Tier X-Y Maps found have X% chance to become 1 tier higher":s.replace(/(\d+(?:\.\d+)?)(%|\s|$)/g,"X$2").replace(/\s+/g," ").trim():"";var s;t?n[t]?(n[t].count++,n[t].instances.push({value:ue(e.Mod).value,text:e.Mod})):n[t]={...e,count:1,matchPattern:ue(e.Mod),instances:[{value:ue(e.Mod).value,text:e.Mod}]}:console.warn("Could not generate base key for mod:",e.Mod)})),Object.values(n).map((e=>{if(!e||!e.matchPattern||"unstackable"===e.matchPattern.type)return e;const t=Number(e.instances.reduce(((e,t)=>e+(t.value||0)),0).toFixed(1)),s={...e};if("additional"!==e.matchPattern.type||t)if(e.Mod&&e.Mod.match(/Tier \d+-\d+ Maps found have/)){const r=e.Mod.match(/Tier (\d+-\d+) Maps found have/);r&&r[1]?s.mod=e.Mod.replace(/have\s+\d+(?:\.\d+)?%/,`have ${t}%`):s.mod=e.Mod.replace(/(\d+(?:\.\d+)?)(%|\s|$)/,`${t}$2`)}else e.Mod?s.mod=e.Mod.replace(/(\d+(?:\.\d+)?)(%|\s|$)/,`${t}$2`):s.mod="Unknown modifier";else s.mod=e.Mod.replace(/an additional/i,`${e.count} additional`);return s.stackedValue=t,s}))})(e):[]),[e]),d=(0,r.useMemo)((()=>{if(!Array.isArray(o)||0===o.length)return{};const e={Unique:o.filter((e=>null===e||void 0===e?void 0:e.isUnique))};return o.filter((e=>e&&!e.isUnique)).forEach((t=>{if(null===t||void 0===t||!t.name)return;const s=t.name;e[s]||(e[s]=[]),e[s].push(t)})),Object.fromEntries(Object.entries(e).filter((e=>{let[t,s]=e;return(null===s||void 0===s?void 0:s.length)>0})))}),[o]),c=(0,r.useMemo)((()=>Array.isArray(o)?o.filter((e=>e&&(l||!e.isUnique))):[]),[o,l]),u=(0,r.useMemo)((()=>{if(!Array.isArray(e))return{};const t={},s=new Set;return e.forEach(((e,r)=>{e.forEach(((e,i)=>{if(!e)return;const n=e.position||{row:r,col:i},a=`${n.row}-${n.col}`;if(!s.has(a)&&(s.add(a),!e.isUnique||l)){const s=e.type||"Minor Idol";t[s]=(t[s]||0)+1}}))})),t}),[e,l]);(0,r.useEffect)((()=>{n([])}),[e]);const m=(0,r.useMemo)((()=>d&&"object"===typeof d?Object.keys(d).filter((e=>"Unique"!==e)).sort():[]),[d]);return null!==o&&void 0!==o&&o.length?(0,q.jsxs)(le,{title:"Active Modifiers",headerRight:(0,q.jsx)(V,{variant:"amber",size:"sm",onClick:()=>s(!0),children:"Export to Text"}),children:[(0,q.jsx)("div",{className:"space-y-6",children:Object.entries(d).map((e=>{let[t,s]=e;return(0,q.jsx)(ge,{name:t,modifiers:s},t)}))}),t&&(0,q.jsx)(he,{onClose:()=>s(!1),availableStrategies:m,selectedStrategies:i,setSelectedStrategies:n,includeUniques:l,setIncludeUniques:a,exportText:(()=>{const t=i.length>0?`Strategy: ${i.join(", ")}`:"Strategy:",s=c.filter((e=>!(null!==e&&void 0!==e&&e.isUnique))),r=c.filter((e=>null===e||void 0===e?void 0:e.isUnique)),n=s.map((e=>{if(!e||!e.mod&&!e.Mod)return"";let t=e.mod||e.Mod;return e.count>1&&(t=`${t} (${e.count}x)`),`- ${t}`})).filter(Boolean).join("\n")+(r.length>0?"\nUnique Modifiers:\n"+r.map((e=>{if(!e||!e.mod&&!e.Mod)return"";let t=e.mod||e.Mod;return e.count>1&&(t=`${t} (${e.count}x)`),`- ${t}`})).filter(Boolean).join("\n"):"");let a="";if(l){const t=new Set,s=[];null===e||void 0===e||e.forEach(((e,r)=>{null===e||void 0===e||e.forEach(((e,i)=>{if(null===e||void 0===e||!e.isUnique)return;const n=e.position||{row:r,col:i},l=`${n.row}-${n.col}`;t.has(l)||(t.add(l),s.push(e.name||"Unnamed Unique Idol"))}))})),a=s.length>0?`\n\nUnique Idols:\n${s.map((e=>`- ${e}`)).join("\n")}`:""}return`${t}\nIdol Stats:\n${n}${a}\n\nIdol Types:\n${Object.entries(u).map((e=>{let[t,s]=e;return`- ${s}x ${t}`})).join("\n")}`})()})]}):(0,q.jsx)(le,{title:"Active Modifiers",children:(0,q.jsx)("p",{className:"text-slate-400",children:"No active modifiers. Place idols on the grid to see their effects."})})}(0,r.memo)((e=>{let{name:t,modifiers:s}=e;return Array.isArray(s)&&0!==s.length?(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsx)("h3",{className:"font-semibold text-base text-amber-400 border-l-4 border-amber-400 pl-2 mb-3",children:t}),(0,q.jsx)("ul",{className:"space-y-2 minimal-scrollbar",children:s.map(((e,s)=>e&&(e.mod||e.Mod)?(0,q.jsx)(be,{mod:e,count:e.count||1},`${t}-${s}`):null))})]}):null})).displayName="MemoizedModifierGroup";const ye=(0,r.memo)(ve),je=e=>{let{modifier:t,inModifierList:s=null,searchContext:i="builder",onClick:n,onRemove:l=null}=e;const a="prefix"===t.type,o=(0,r.useCallback)((()=>{n&&n(t,t.type)}),[n,t]),d=(0,r.useCallback)((e=>{e.preventDefault(),l&&l(t)}),[l,t]),c=a?"bg-gradient-to-r from-blue-900/30 to-slate-800/70 border border-blue-800/50 hover:from-blue-800/30 hover:border-blue-700/70":"bg-gradient-to-r from-green-900/30 to-slate-800/70 border border-green-800/50 hover:from-green-800/30 hover:border-green-700/70",u=s?"ring-1 ring-amber-500/70":"",m=l?a?"Click to add prefix, right-click to remove":"Click to add suffix, right-click to remove":a?"Click to add prefix":"Click to add suffix";return(0,q.jsxs)("div",{className:`p-3 rounded-md cursor-pointer transition-colors select-none h-full flex flex-col justify-center ${c} ${u}`,onClick:o,onContextMenu:d,title:m,role:"button","aria-label":m,children:[(0,q.jsx)("div",{className:"flex justify-between items-start",children:s&&(0,q.jsxs)("span",{className:"text-yellow-400 font-bold text-xs",children:["(",s.count,"\xd7)"]})}),(0,q.jsx)("div",{className:"text-sm text-slate-300 line-clamp-3",children:t.Mod}),"autogen"===i&&t.supportedTypes&&(0,q.jsxs)("div",{className:"text-slate-400 text-xs mt-1 line-clamp-1",children:["Available on: ",t.supportedTypes.join(", ")]})]})},we=r.memo(je),Ne=(0,r.memo)((e=>{let{viewByName:t,handleViewModeChange:s}=e;return(0,q.jsxs)("div",{className:"flex space-x-2 mb-4 p-3",children:[(0,q.jsx)("button",{className:"px-3 py-2 rounded-md text-sm font-medium transition-colors "+(t?"bg-slate-700 text-slate-300 hover:bg-slate-600":"bg-indigo-600 text-white"),onClick:()=>s(!1),children:"Search by Text"}),(0,q.jsx)("button",{className:"px-3 py-2 rounded-md text-sm font-medium transition-colors "+(t?"bg-indigo-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),onClick:()=>s(!0),children:"Browse by Name"})]})}));Ne.displayName="ModeToggleButtons";const Ce=(0,r.memo)((e=>{let{item:t,isSelected:s,isFullySelected:r,onClick:i}=e;return(0,q.jsx)("button",{className:"px-3 py-1.5 text-sm rounded-md transition-colors "+(s?"bg-indigo-600 text-white font-medium "+(r?"":"ring-2 ring-indigo-300"):"bg-slate-700 text-slate-300 hover:bg-slate-600"),onClick:()=>i(t),children:t.name})}));Ce.displayName="NameTag";const ke=(0,r.memo)((e=>{let{filterType:t,onChange:s}=e;return(0,q.jsxs)("select",{className:"bg-slate-700 p-2.5 rounded-md border-0 text-sm flex-grow ring-1 ring-slate-600 focus:ring-2 focus:ring-indigo-500 outline-none",value:t,onChange:s,children:[(0,q.jsx)("option",{value:"all",children:"All Types"}),(0,q.jsx)("option",{value:"prefix",children:"Prefixes Only"}),(0,q.jsx)("option",{value:"suffix",children:"Suffixes Only"})]})}));ke.displayName="FilterTypeSelect";const Me=(0,r.memo)((e=>{let{count:t,onClear:s}=e;return(0,q.jsxs)("div",{className:"mb-3 px-1 py-1 bg-indigo-900/30 border border-indigo-700/50 rounded-md text-sm font-medium text-indigo-300 flex items-center justify-between",children:[(0,q.jsxs)("div",{className:"flex items-center",children:[(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),t," name",t>1?"s":""," selected"]}),(0,q.jsx)("button",{onClick:s,className:"bg-indigo-700 hover:bg-indigo-600 px-2 py-0.5 rounded text-xs text-white transition-colors mr-1",children:"Reset"})]})}));Me.displayName="SelectionIndicator";const Se=e=>{let{modData:t,onAddModifier:s,onRemoveModifier:i=null,modifierList:n=[],selectedType:l="",initialState:a=null,onSearchUpdate:o=null,searchContext:d="builder",selectedPrefixes:c=[],selectedSuffixes:u=[]}=e;const[m,f]=(0,r.useState)((null===a||void 0===a?void 0:a.searchTerm)||""),[x,h]=(0,r.useState)((null===a||void 0===a?void 0:a.filterType)||"all"),[p,g]=(0,r.useState)((null===a||void 0===a?void 0:a.viewByName)||!1),[b,v]=(0,r.useState)((null===a||void 0===a?void 0:a.selectedNames)||[]),[y,j]=(0,r.useState)(""),[w,N]=(0,r.useState)([]),{modifierGroups:C,nameToGroupMap:k}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"builder";const{modData:i}=(0,r.useContext)(A),[n,l]=(0,r.useState)((null===e||void 0===e?void 0:e.searchTerm)||""),[a,o]=(0,r.useState)((null===e||void 0===e?void 0:e.filterType)||"all"),[d,c]=(0,r.useState)((null===e||void 0===e?void 0:e.viewByName)||!1),[u,m]=(0,r.useState)((null===e||void 0===e?void 0:e.selectedNames)||[]),[f,x]=(0,r.useState)(""),[h,p]=(0,r.useState)([]),g=(0,r.useMemo)((()=>({Bossing:["Conqueror","Shaper","Maven","Synthesis","Elder"],Eldritch:["Eater","Exarch"],Mapping:["Cartographer","Kirac","Scouting"]})),[]),b=(0,r.useMemo)((()=>Object.entries(g).reduce(((e,t)=>{let[s,r]=t;return r.forEach((t=>{e[t]=s})),e}),{})),[g]),v=(0,r.useMemo)((()=>{if(!i.prefixes||!i.suffixes)return{prefixes:[],suffixes:[]};const t=new Set,r=new Set;if("builder"===s&&(null===e||void 0===e?void 0:e.selectedType)){const s=e.selectedType;i.prefixes[s]&&i.prefixes[s].forEach((e=>t.add(e.Name))),i.suffixes[s]&&i.suffixes[s].forEach((e=>r.add(e.Name)))}else Object.values(i.prefixes).forEach((e=>{e.forEach((e=>t.add(e.Name)))})),Object.values(i.suffixes).forEach((e=>{e.forEach((e=>r.add(e.Name)))}));return{prefixes:Array.from(t).sort(),suffixes:Array.from(r).sort()}}),[i,null===e||void 0===e?void 0:e.selectedType,s]),y=(0,r.useMemo)((()=>{if("all"!==a)return[];const e=new Set([...v.prefixes,...v.suffixes]);return Array.from(e).sort()}),[v.prefixes,v.suffixes,a]),j=(0,r.useMemo)((()=>{let e;switch(a){case"prefix":e=v.prefixes;break;case"suffix":e=v.suffixes;break;default:e=y}const t=[],s=new Set;return e.forEach((e=>{const r=b[e]||null;r&&!s.has(r)?(t.push({isGroup:!0,name:r}),s.add(r)):r||t.push({isGroup:!1,name:e})})),t.sort(((e,t)=>e.name.localeCompare(t.name)))}),[a,v,y,b]),w=(0,r.useCallback)((e=>g[e]||[]),[g]),N=(0,r.useCallback)((e=>l(e.target.value)),[]),C=(0,r.useCallback)((e=>o(e.target.value)),[]),k=(0,r.useCallback)((e=>{c(e),m([])}),[]),M=(0,r.useCallback)((e=>{if(e.isGroup){const t=w(e.name);t.every((e=>u.includes(e)))?(m((e=>e.filter((e=>!t.includes(e))))),p((t=>t.filter((t=>t!==e.name))))):(m((e=>{const s=[...e];return t.forEach((e=>{s.includes(e)||s.push(e)})),s})),p((t=>t.includes(e.name)?t:[...t,e.name])))}else m((t=>t.includes(e.name)?t.filter((t=>t!==e.name)):[...t,e.name]))}),[u,w]),S=(0,r.useCallback)((e=>{const t=[{type:"plusChance",regex:/\+(\d+(?:\.\d+)?)%\s+chance/i},{type:"haveChance",regex:/have\s+(\d+(?:\.\d+)?)%\s+(?:increased\s+)?chance/i},{type:"increased",regex:/(\d+(?:\.\d+)?)%\s+increased/i},{type:"more",regex:/(\d+(?:\.\d+)?)%\s+more/i},{type:"reduced",regex:/(\d+(?:\.\d+)?)%\s+reduced/i},{type:"faster",regex:/(\d+(?:\.\d+)?)%\s+faster/i},{type:"slower",regex:/(\d+(?:\.\d+)?)%\s+slower/i},{type:"additional",regex:/additional/i},{type:"numeric",regex:/(\d+(?:\.\d+)?)/}];for(const{type:r,regex:i}of t){const t=e.match(i);var s;if(t)return{type:r,value:"additional"!==r?parseFloat(t[1]):null!==(s=e.match(/(\d+)/))&&void 0!==s&&s[1]?parseFloat(e.match(/(\d+)/)[1]):1,fullText:e}}return{type:"unstackable",value:null,fullText:e}}),[]),T=(0,r.useCallback)((e=>e.replace(/(\d+(?:\.\d+)?)(%|\s|$)/g,"X$2").replace(/\s+/g," ").trim()),[]);return(0,r.useEffect)((()=>{if(!t)return;const e=setTimeout((()=>{t({searchTerm:n,filterType:a,viewByName:d,selectedNames:u})}),50);return()=>clearTimeout(e)}),[n,a,d,u,t]),{searchTerm:n,setSearchTerm:l,filterType:a,setFilterType:o,viewByName:d,setViewByName:c,selectedNames:u,setSelectedNames:m,nameSearchTerm:f,setNameSearchTerm:x,selectedGroupNames:h,handleSearchTermChange:N,handleFilterTypeChange:C,handleViewModeChange:k,handleNameSelection:M,modifierGroups:g,nameToGroupMap:b,getNamesInGroup:w,modifierNames:v,combinedUniqueNames:y,nameTagsToDisplay:j,getMatchPattern:S,getBaseEffectKey:T}}(),M=(0,r.useCallback)((e=>f(e.target.value)),[]),S=(0,r.useCallback)((e=>h(e.target.value)),[]),T=(0,r.useCallback)((e=>j(e.target.value)),[]),I=(0,r.useCallback)((()=>{v([]),N([])}),[]),$=(0,r.useCallback)((e=>{g(e),v([])}),[]),L=(0,r.useCallback)((e=>{if(e.isGroup){const t=C[e.name]||[];t.every((e=>b.includes(e)))?(v((e=>e.filter((e=>!t.includes(e))))),N((t=>t.filter((t=>t!==e.name))))):(v((e=>{const s=[...e];return t.forEach((e=>{s.includes(e)||s.push(e)})),s})),N((t=>t.includes(e.name)?t:[...t,e.name])))}else v((t=>t.includes(e.name)?t.filter((t=>t!==e.name)):[...t,e.name]))}),[C,b]);(0,r.useEffect)((()=>{if(!o)return;const e=setTimeout((()=>{o({searchTerm:m,filterType:x,viewByName:p,selectedNames:b})}),50);return()=>clearTimeout(e)}),[m,x,p,b,o]);const E=(0,r.useCallback)((e=>{if("builder"===d||"trade"===d){return"prefix"===x||"all"===x&&t.prefixes&&Object.values(t.prefixes).some((t=>t.some((t=>t.id===e.id))))?c.some((t=>t.id===e.id))?{count:1}:null:u.some((t=>t.id===e.id))?{count:1}:null}return n.find((t=>t.id===e.id))||null}),[x,t,c,u,n,d]),P=(0,r.useMemo)((()=>{if(!t.prefixes||!t.suffixes)return{prefixes:[],suffixes:[]};const e=new Set,s=new Set;return"builder"===d&&l?(t.prefixes[l]&&t.prefixes[l].forEach((t=>e.add(t.Name))),t.suffixes[l]&&t.suffixes[l].forEach((e=>s.add(e.Name)))):(Object.values(t.prefixes).forEach((t=>{t.forEach((t=>e.add(t.Name)))})),Object.values(t.suffixes).forEach((e=>{e.forEach((e=>s.add(e.Name)))}))),{prefixes:Array.from(e).sort(),suffixes:Array.from(s).sort()}}),[t,l,d]),B=(0,r.useMemo)((()=>{if("all"!==x)return[];const e=new Set([...P.prefixes,...P.suffixes]);return Array.from(e).sort()}),[P.prefixes,P.suffixes,x]),U=(0,r.useCallback)(((e,t)=>{const s=t.toLowerCase();return e.sort(((e,t)=>{const r=e.Name.toLowerCase().indexOf(s),i=t.Name.toLowerCase().indexOf(s);return-1!==r&&-1===i?-1:-1===r&&-1!==i?1:-1!==r&&-1!==i?r-i:e.Name.localeCompare(t.Name)})).slice(0,50)}),[]),R=(0,r.useMemo)((()=>{if(!t.prefixes||!t.suffixes)return{prefixes:[],suffixes:[]};if("autogen"===d){if(p&&b.length>0){const e={prefixes:[],suffixes:[]};return b.forEach((s=>{if("all"===x||"prefix"===x){const r=[],i=new Set;Object.entries(t.prefixes).forEach((e=>{let[n,l]=e;l.forEach((e=>{if(e.Name===s&&!i.has(e.Mod)){i.add(e.Mod);const s=Object.entries(t.prefixes).filter((t=>{let[s,r]=t;return r.some((t=>t.Mod===e.Mod))})).map((e=>{let[t]=e;return t}));r.push({...e,supportedTypes:s})}}))})),e.prefixes=[...e.prefixes,...r]}if("all"===x||"suffix"===x){const r=[],i=new Set;Object.entries(t.suffixes).forEach((e=>{let[n,l]=e;l.forEach((e=>{if((e.Name===s||e.Name===`of ${s}`)&&!i.has(e.Mod)){i.add(e.Mod);const s=Object.entries(t.suffixes).filter((t=>{let[s,r]=t;return r.some((t=>t.Mod===e.Mod))})).map((e=>{let[t]=e;return t}));r.push({...e,supportedTypes:s})}}))})),e.suffixes=[...e.suffixes,...r]}})),e}if(m){const e=m.toLowerCase(),s={prefixes:[],suffixes:[]};if("all"===x||"prefix"===x){const r=[],i=new Set;Object.entries(t.prefixes).forEach((s=>{let[n,l]=s;l.forEach((s=>{if((s.Name.toLowerCase().includes(e)||s.Mod.toLowerCase().includes(e))&&!i.has(s.Mod)){i.add(s.Mod);const e=Object.entries(t.prefixes).filter((e=>{let[t,r]=e;return r.some((e=>e.Mod===s.Mod))})).map((e=>{let[t]=e;return t}));r.push({...s,supportedTypes:e})}}))})),s.prefixes=U(r,m)}if("all"===x||"suffix"===x){const r=[],i=new Set;Object.entries(t.suffixes).forEach((s=>{let[n,l]=s;l.forEach((s=>{if((s.Name.toLowerCase().includes(e)||s.Mod.toLowerCase().includes(e))&&!i.has(s.Mod)){i.add(s.Mod);const e=Object.entries(t.suffixes).filter((e=>{let[t,r]=e;return r.some((e=>e.Mod===s.Mod))})).map((e=>{let[t]=e;return t}));r.push({...s,supportedTypes:e})}}))})),s.suffixes=U(r,m)}return s}return{prefixes:[],suffixes:[]}}if(p&&b.length>0){const e={prefixes:[],suffixes:[]};return b.forEach((s=>{if("all"===x||"prefix"===x)if("builder"===d&&l&&t.prefixes[l]){const r=t.prefixes[l].filter((e=>e.Name===s));e.prefixes=[...e.prefixes,...r]}else Object.values(t.prefixes).forEach((t=>{const r=t.filter((e=>e.Name===s));e.prefixes=[...e.prefixes,...r]}));if("all"===x||"suffix"===x)if("builder"===d&&l&&t.suffixes[l]){const r=t.suffixes[l].filter((e=>e.Name===s||e.Name===`of ${s}`));e.suffixes=[...e.suffixes,...r]}else Object.values(t.suffixes).forEach((t=>{const r=t.filter((e=>e.Name===s||e.Name===`of ${s}`));e.suffixes=[...e.suffixes,...r]}))})),e}if(m){const e=m.toLowerCase(),s={prefixes:[],suffixes:[]};if("all"===x||"prefix"===x){let r=[];if("builder"===d&&l&&t.prefixes[l])r=t.prefixes[l].filter((t=>t.Name.toLowerCase().includes(e)||t.Mod.toLowerCase().includes(e)));else{r=Object.values(t.prefixes).flat().filter((t=>t.Name.toLowerCase().includes(e)||t.Mod.toLowerCase().includes(e)))}s.prefixes=U(r,m)}if("all"===x||"suffix"===x){let r=[];if("builder"===d&&l&&t.suffixes[l])r=t.suffixes[l].filter((t=>t.Name.toLowerCase().includes(e)||t.Mod.toLowerCase().includes(e)));else{r=Object.values(t.suffixes).flat().filter((t=>t.Name.toLowerCase().includes(e)||t.Mod.toLowerCase().includes(e)))}s.suffixes=U(r,m)}return s}return{prefixes:[],suffixes:[]}}),[m,x,t,l,p,b,d,U]),D=(0,r.useMemo)((()=>{let e=[];e="all"===x?B:"prefix"===x?P.prefixes:P.suffixes;const t=[],s=new Set;return e.forEach((e=>{const r=(e=>k[e]||null)(e);r&&!s.has(r)?(t.push({isGroup:!0,name:r}),s.add(r)):r||t.push({isGroup:!1,name:e})})),t.sort(((e,t)=>e.name.localeCompare(t.name)))}),[x,P,B,k]),O=(0,r.useMemo)((()=>{if(""===y)return D;const e=y.toLowerCase();return D.filter((t=>t.isGroup?t.name.toLowerCase().includes(e)||(C[t.name]||[]).some((t=>t.toLowerCase().includes(e))):t.name.toLowerCase().includes(e)))}),[D,y,C]),F=(0,r.useMemo)((()=>w.length+b.filter((e=>!w.some((t=>(C[t]||[]).includes(e))))).length),[b,w,C]);return(0,q.jsxs)("div",{className:"bg-slate-800 rounded-lg ring-1 ring-slate-700",children:[(0,q.jsx)(Ne,{viewByName:p,handleViewModeChange:$}),p?(0,q.jsx)("div",{className:"px-3 pb-3",children:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("div",{className:"mb-3 flex space-x-2",children:(0,q.jsx)(ke,{filterType:x,onChange:S})}),(0,q.jsx)("div",{className:"mb-3",children:(0,q.jsx)("input",{type:"text",className:"w-full bg-slate-700 p-2.5 rounded-md border-0 text-sm ring-1 ring-slate-600 focus:ring-2 focus:ring-indigo-500 outline-none",value:y,onChange:T,placeholder:"Filter modifier names..."})}),F>0&&(0,q.jsx)(Me,{count:F,onClear:I}),(0,q.jsx)("div",{className:"flex flex-wrap gap-2 max-h-52 overflow-y-auto rounded-md px-1 py-2 custom-scrollbar",children:O.map((e=>{const t=e.isGroup?(C[e.name]||[]).some((e=>b.includes(e))):b.includes(e.name),s=e.isGroup?(C[e.name]||[]).every((e=>b.includes(e))):t;return(0,q.jsx)(Ce,{item:e,isSelected:t,isFullySelected:s,onClick:L},`name-tag-${e.isGroup?"group-":""}${e.name}`)}))})]})}):(0,q.jsx)("div",{className:"px-3 pb-3",children:(0,q.jsxs)("div",{className:"flex",children:[(0,q.jsx)("input",{type:"text",className:"flex-grow bg-slate-700 p-2.5 rounded-l-md border-0 text-sm ring-1 ring-slate-600 focus:ring-2 focus:ring-indigo-500 outline-none",value:m,onChange:M,placeholder:"Search for modifiers..."}),(0,q.jsxs)("select",{className:"bg-slate-700 p-2.5 rounded-r-md border-0 border-l-0 text-sm ring-1 ring-slate-600 focus:ring-2 focus:ring-indigo-500 outline-none",value:x,onChange:S,children:[(0,q.jsx)("option",{value:"all",children:"All"}),(0,q.jsx)("option",{value:"prefix",children:"Prefixes"}),(0,q.jsx)("option",{value:"suffix",children:"Suffixes"})]})]})}),p&&b.length>0?(0,q.jsx)("div",{className:"space-y-5 px-3 pb-3",children:Array.from(new Set(b)).sort().map((e=>{const t=R.prefixes.filter((t=>t.Name===e)),r=R.suffixes.filter((t=>t.Name===e||t.Name===`of ${e}`)),n=t.length>0||r.length>0;return(0,q.jsxs)("div",{className:"border-t border-slate-700 pt-4 mt-4",children:[(0,q.jsx)("h3",{className:"font-medium text-amber-400 mb-3 text-base px-1",children:e}),n?(0,q.jsx)("div",{className:"max-h-[400px] overflow-y-auto p-2 custom-scrollbar",children:(0,q.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[t.map(((e,t)=>(0,q.jsx)(we,{modifier:{...e,type:"prefix"},inModifierList:E(e),searchContext:d,onClick:s,onRemove:i},`prefix-${e.id}-${t}`))),r.map(((e,t)=>(0,q.jsx)(we,{modifier:{...e,type:"suffix"},inModifierList:E(e),searchContext:d,onClick:s,onRemove:i},`suffix-${e.id}-${t}`)))]})}):(0,q.jsxs)("div",{className:"text-slate-400 py-3 text-sm px-1",children:['No modifiers found for "',e,'" with current idol type']})]},`name-group-${e}`)}))}):(()=>{const e=R.prefixes.length>0,t=R.suffixes.length>0,r=m||b.length>0,n=r&&!e&&!t;return(0,q.jsxs)("div",{className:"space-y-4 px-3 pb-3",children:[e&&(0,q.jsxs)("div",{children:[(0,q.jsxs)("h3",{className:"font-medium text-blue-400 text-sm px-1 mb-2",children:["Prefixes (",R.prefixes.length,")"]}),(0,q.jsx)("div",{className:"max-h-[400px] overflow-y-auto p-2 custom-scrollbar",children:(0,q.jsx)("div",{className:"grid grid-cols-2 gap-2",children:R.prefixes.map(((e,t)=>(0,q.jsx)(we,{modifier:{...e,type:"prefix"},inModifierList:E(e),searchContext:d,onClick:s,onRemove:i},`prefix-${e.id}-${t}`)))})})]}),t&&(0,q.jsxs)("div",{children:[(0,q.jsxs)("h3",{className:"font-medium text-green-400 text-sm px-1 mb-2",children:["Suffixes (",R.suffixes.length,")"]}),(0,q.jsx)("div",{className:"max-h-[400px] overflow-y-auto p-2 custom-scrollbar",children:(0,q.jsx)("div",{className:"grid grid-cols-2 gap-2",children:R.suffixes.map(((e,t)=>(0,q.jsx)(we,{modifier:{...e,type:"suffix"},inModifierList:E(e),searchContext:d,onClick:s,onRemove:i},`suffix-${e.id}-${t}`)))})})]}),n&&(0,q.jsxs)("p",{className:"text-slate-400 py-2 text-sm text-center",children:['No modifiers found matching "',m||b.join(", "),'"']}),!r&&(0,q.jsx)("p",{className:"text-slate-400 py-2 text-sm text-center",children:"Enter search terms or select modifier name(s) to see results"})]})})()]})},Te=(0,r.memo)(Se),Ie=e=>{let{types:t,onCreateIdol:s}=e;return(0,q.jsx)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:t.map((e=>(0,q.jsxs)("button",{className:"py-3 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-md font-medium transition-colors",onClick:()=>s(e),children:["Create ",e," Idol"]},e)))})},$e=e=>{let{items:t,onRemove:s,type:r}=e;return 0===t.length?(0,q.jsxs)("div",{className:"p-4 bg-slate-800 rounded-md text-sm text-slate-400 text-center mb-4 ring-1 ring-slate-700",children:["No ",r,"es selected"]}):(0,q.jsx)("ul",{className:"mb-4 space-y-2",children:t.map(((e,t)=>(0,q.jsxs)("li",{className:"bg-slate-800 p-3 rounded-md flex justify-between ring-1 ring-slate-700",onContextMenu:e=>{e.preventDefault(),s(t)},children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("div",{className:"text-sm font-medium "+("prefix"===r?"text-blue-400":"text-green-400"),children:e.Name}),(0,q.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:e.Mod})]}),(0,q.jsx)("button",{onClick:()=>s(t),className:"text-slate-400 hover:text-slate-300 ml-2 self-start",title:`Remove ${r}`,children:"\u2715"})]},t)))})},Le=e=>{let{message:t}=e;return t?(0,q.jsx)("div",{className:"bg-red-900/50 p-3 rounded-lg border border-red-800 text-red-200 text-sm",children:t}):null};const Ee=function(e){let{modData:t,idolTypes:s,onAddIdol:i}=e;const n=(0,r.useMemo)((()=>[{label:"Minor (1\xd71)",value:"Minor"},{label:"Kamasan (1\xd72) \u2022 Noble (2\xd71)",value:"KamasanNoble"},{label:"Totemic (1\xd73) \u2022 Burial (3\xd71)",value:"TotemicBurial"},{label:"Conqueror (2\xd72)",value:"Conqueror"}]),[]),[l,a]=(0,r.useState)(""),[o,d]=(0,r.useState)([]),[c,u]=(0,r.useState)([]),[m,f]=(0,r.useState)(""),[x,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),[b,v]=(0,r.useState)({searchTerm:"",filterType:"all",viewByName:!1,selectedNames:[]}),y=(0,r.useMemo)((()=>"KamasanNoble"===l||"TotemicBurial"===l),[l]),j=(0,r.useMemo)((()=>"KamasanNoble"===l?["Kamasan","Noble"]:"TotemicBurial"===l?["Totemic","Burial"]:[]),[l]);(0,r.useEffect)((()=>{d([]),u([]),h(null)}),[l]),(0,r.useEffect)((()=>()=>{p&&clearTimeout(p)}),[p]);const w=(0,r.useCallback)(((e,t)=>{if(!e||!t||e.Name!==t.Name)return{exclusive:!1};if(!["Breach","Domination","Essence","Harbinger","Ambush","Torment"].includes(e.Name))return{exclusive:!1};const s=[{name:"Breach",patterns:["Breaches in your Maps contain 3 additional Clasped Hands","Breaches in your Maps contain 2 additional Clasped Hands"]},{name:"Domination",patterns:["Your Maps contain an additional Shrine","Your Maps contain 2 additional Shrines"]},{name:"Essence",patterns:["Your Maps contain an additional Imprisoned Monster","Your Maps contain 2 additional Imprisoned Monsters"]},{name:"Harbinger",patterns:["Your Maps contain an additional Harbinger","Your Maps contain 2 additional Harbingers"]},{name:"Ambush",patterns:["Your Maps contain an additional Strongbox","Your Maps contain 2 additional Strongboxes"]},{name:"Torment",patterns:["Your Maps are haunted by an additional Tormented Spirit","Your Maps are haunted by 2 additional Tormented Spirits"]}].find((t=>t.name===e.Name));if(!s)return{exclusive:!1};const r=s.patterns.includes(e.Mod),i=s.patterns.includes(t.Mod);return r&&i&&e.Mod!==t.Mod?{exclusive:!0,name:s.name}:{exclusive:!1}}),[]),N=(0,r.useCallback)(((e,t)=>{if(h(null),p&&(clearTimeout(p),g(null)),"prefix"===t){if(o.length<2){for(const t of o){const s=w(t,e);if(s.exclusive){const e=`Cannot add multiple ${s.name} modifiers that add different amounts to the same idol.`;h(e);const t=setTimeout((()=>h(null)),5e3);return void g(t)}}o.some((t=>t.id===e.id))||d((t=>[...t,e]))}}else if("suffix"===t&&c.length<2){for(const t of c){const s=w(t,e);if(s.exclusive){const e=`Cannot add multiple ${s.name} modifiers that add different amounts to the same idol.`;h(e);const t=setTimeout((()=>h(null)),5e3);return void g(t)}}c.some((t=>t.id===e.id))||u((t=>[...t,e]))}}),[o,c,w,p]),C=(0,r.useCallback)((e=>{d((t=>t.filter(((t,s)=>s!==e)))),h(null)}),[]),k=(0,r.useCallback)((e=>{u((t=>t.filter(((t,s)=>s!==e)))),h(null)}),[]),M=(0,r.useCallback)((e=>{"prefix"===e.type?d((t=>t.filter((t=>t.id!==e.id)))):u((t=>t.filter((t=>t.id!==e.id)))),h(null)}),[]),S=(0,r.useCallback)(((e,t,s)=>{let r=e;return t.length>0&&(r=`${t[0].Name} ${r}`),s.length>0&&(r=`${r} ${s[0].Name}`),r}),[]),T=(0,r.useCallback)((function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||l;if(!e)return;const t=m||S(e,o,c);i({type:e,name:t,prefixes:o,suffixes:c}),f(""),d([]),u([])}),[l,m,o,c,S,i]),I=(0,r.useCallback)((()=>l&&t.prefixes&&t.suffixes?"KamasanNoble"===l?{prefixes:{KamasanNoble:t.prefixes.Kamasan||[]},suffixes:{KamasanNoble:t.suffixes.Kamasan||[]}}:"TotemicBurial"===l?{prefixes:{TotemicBurial:t.prefixes.Burial||[]},suffixes:{TotemicBurial:t.suffixes.Burial||[]}}:{prefixes:{[l]:t.prefixes[l]||[]},suffixes:{[l]:t.suffixes[l]||[]}}:{prefixes:{},suffixes:{}}),[l,t.prefixes,t.suffixes]),$=(0,r.useCallback)((e=>{v(e)}),[]);return(0,q.jsxs)("div",{className:"bg-slate-900 p-5 rounded-xl shadow-sm",children:[(0,q.jsx)("h2",{className:"text-xl font-bold mb-1 text-white",children:"Idol Builder"}),(0,q.jsx)("p",{className:"text-sm text-slate-400 mb-4",children:"Create custom idols with specific modifiers to add to your inventory."}),(0,q.jsxs)("div",{className:"space-y-5",children:[(0,q.jsx)(Le,{message:x}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block mb-2 text-sm text-slate-300",children:"Idol Type"}),(0,q.jsxs)("select",{className:"w-full bg-slate-800 p-3 rounded-md border-0 text-sm ring-1 ring-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none",value:l,onChange:e=>a(e.target.value),children:[(0,q.jsx)("option",{value:"",children:"Select Idol Type"}),n.map((e=>(0,q.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block mb-2 text-sm text-slate-300",children:"Idol Name (Optional)"}),(0,q.jsx)("input",{type:"text",className:"w-full bg-slate-800 p-3 rounded-md border-0 text-sm ring-1 ring-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none",value:m,onChange:e=>f(e.target.value),placeholder:"Custom Idol Name"})]}),l&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsxs)("h3",{className:"font-medium mb-2 text-sm text-slate-300",children:["Selected Prefixes (",o.length,"/2)"]}),(0,q.jsx)($e,{items:o,onRemove:C,type:"prefix"})]}),(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsxs)("h3",{className:"font-medium mb-2 text-sm text-slate-300",children:["Selected Suffixes (",c.length,"/2)"]}),(0,q.jsx)($e,{items:c,onRemove:k,type:"suffix"})]}),(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsx)("h3",{className:"font-medium mb-2 text-sm text-slate-300",children:"Search & Add Modifiers"}),(0,q.jsx)(Te,{modData:l?I():t,onAddModifier:N,onRemoveModifier:M,selectedType:l,initialState:b,onSearchUpdate:$,searchContext:"builder",selectedPrefixes:o,selectedSuffixes:c})]}),y?(0,q.jsx)(Ie,{types:j,onCreateIdol:T}):(0,q.jsx)("button",{className:"w-full mt-4 py-3 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-md font-medium transition-colors",onClick:()=>T(),disabled:!l,children:"Create Idol"})]})]})]})},qe={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl","3xl":"max-w-3xl","4xl":"max-w-4xl","5xl":"max-w-5xl",full:"max-w-full"},Ae=e=>{let{isOpen:t,onClose:s,title:i,children:n,actions:l,maxWidth:a="md",className:o=""}=e;if((0,r.useEffect)((()=>{const e=e=>{"Escape"===e.key&&s()};return t&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[t,s]),!t)return null;const d=qe[a]||qe.md;return(0,q.jsx)("div",{className:"fixed inset-0 bg-slate-950 bg-opacity-80 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,q.jsxs)("div",{className:`bg-slate-900 rounded-xl p-6 w-full shadow-lg border border-slate-800 ${d} ${o}`,children:[(0,q.jsxs)("div",{className:"flex justify-between items-start mb-5",children:[(0,q.jsx)("h2",{className:"text-xl font-bold text-white",children:i}),(0,q.jsx)("button",{onClick:s,className:"text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:"\u2715"})]}),(0,q.jsx)("div",{className:"mb-6",children:n}),l&&(0,q.jsx)("div",{className:"flex justify-end space-x-3",children:l})]})})},Pe=r.memo(Ae);function Be(e,t,s,r,i){null!==e&&void 0!==e&&e.length&&e.forEach((e=>{const n=function(e,t,s,r){if(!e||!e.Mod)return null;const i="prefix"===t?r.prefixes:r.suffixes;if(!i)return null;if(i[s]){const t=i[s].find((t=>t.id===e.id||t.Mod===e.Mod));if(t)return t;const r=i[s].find((t=>me(t.Mod,e.Mod)));if(r)return r}for(const l in i){const t=i[l].find((t=>me(t.Mod,e.Mod)));if(t)return t}const n=fe(e.Mod);return{...e,type:n,id:e.id||`generated-${Date.now()}-${Math.random()}`}}(e,t,s,r);if(n){const e={...n,type:t},s=e.id;if(i.has(s)){i.get(s).count++}else i.set(s,{...e,count:1})}}))}const Ue=()=>(0,q.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,q.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,q.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,q.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}),Re=()=>(0,q.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,q.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"}),(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 14l3-3m0 0l3 3m-3-3v9"})]}),"Load Modifiers from Inventory"]}),De=e=>{let{mod:t,index:s,onRemove:r}=e;return(0,q.jsxs)("li",{className:"p-3 rounded-md flex justify-between items-start \n      "+("prefix"===t.type?"bg-gradient-to-r from-blue-900/30 to-slate-800 border border-blue-800/50":"bg-gradient-to-r from-green-900/30 to-slate-800 border border-green-800/50"),onContextMenu:e=>{e.preventDefault(),r(s)},children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("div",{className:"text-sm",children:[(0,q.jsx)("span",{className:"prefix"===t.type?"text-blue-400 font-medium":"text-green-400 font-medium",children:"prefix"===t.type?"[Prefix]":"[Suffix]"})," ",(0,q.jsx)("span",{className:"text-white font-medium",children:t.Name}),t.count>1&&(0,q.jsxs)("span",{className:"ml-2 text-yellow-400 font-bold",children:["(",t.count,"\xd7)"]})]}),(0,q.jsx)("div",{className:"text-[11px] text-slate-400 mt-1",children:t.Mod})]}),(0,q.jsx)("button",{onClick:()=>r(s),className:"text-slate-400 hover:text-red-400 ml-2 transition-colors",children:"\u2715"})]})};const Oe=function(e){let{modData:t,onGenerateIdols:s}=e;const[i,n]=((e,t)=>{const[s,i]=(0,r.useState)((()=>{try{const s=localStorage.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error("Failed to load from localStorage:",s),t}}));return[s,t=>{try{i(t),localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error("Failed to save to localStorage:",s)}}]})("poe-idol-desired-modifiers",[]),[l,a]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1),[m,f]=(0,r.useState)(!1),{inventory:x,handleClearInventoryExceptUniques:h}=(0,r.useContext)(A),p=(0,r.useRef)({searchTerm:"",filterType:"all",viewByName:!1,selectedNames:[]}),g=(0,r.useMemo)((()=>i.reduce(((e,t)=>e+t.count),0)),[i]),b=(0,r.useMemo)((()=>x.some((e=>!e.isUnique))),[x]),v=(0,r.useCallback)(((e,t)=>{n((s=>{const r=s.findIndex((t=>t.id===e.id));if(r>=0){const e=[...s];return e[r]={...e[r],count:(e[r].count||1)+1},e}return[...s,{...e,type:t,count:1}]}))}),[n]),y=(0,r.useCallback)((e=>{n((t=>{if(t[e].count>1){const s=[...t];return s[e]={...s[e],count:s[e].count-1},s}{const s=[...t];return s.splice(e,1),s}}))}),[n]),j=(0,r.useCallback)((e=>{n((t=>{const s=t.findIndex((t=>t.id===e.id));if(-1!==s){if(t[s].count>1){const e=[...t];return e[s]={...e[s],count:e[s].count-1},e}return t.filter((t=>t.id!==e.id))}return t}))}),[n]),w=(0,r.useCallback)((()=>{d(!0);try{const e=function(e,t){if(null===e||void 0===e||!e.length||!t)return[];const s=e.filter((e=>!e.isUnique)),r=new Map;return s.forEach((e=>{const s=e.type;Be(e.prefixes,"prefix",s,t,r),Be(e.suffixes,"suffix",s,t,r)})),Array.from(r.values())}(x,t);n((t=>{const s=[...t];return e.forEach((e=>{const t=s.findIndex((t=>t.id===e.id));t>=0?s[t]={...s[t],count:(s[t].count||0)+e.count}:s.push(e)})),s})),h()}catch(e){console.error("Error loading modifiers from inventory:",e)}finally{d(!1)}}),[x,t,h,n]),N=(0,r.useCallback)((()=>{if(0===i.length)return;const e=i.map((e=>({...e,count:e.count||1,Name:e.Name,Mod:e.Mod,id:e.id,type:e.type})));s(e),n([])}),[i,s,n]),C=(0,r.useCallback)((e=>{p.current=e}),[]),k=(0,r.useCallback)((()=>{n([]),f(!1)}),[n]);return(0,q.jsxs)(le,{title:"Auto-Generate Idols",children:[(0,q.jsxs)("div",{className:"space-y-6",children:[(0,q.jsx)("p",{className:"text-slate-300 text-sm",children:"Add modifiers you want on your idols, then generate and place them automatically. Click a modifier multiple times to increase its quantity."}),(0,q.jsx)(V,{variant:b?"amber":"disabled",onClick:()=>u(!0),disabled:!b||o,className:"w-full py-3",children:o?(0,q.jsx)(Ue,{}):(0,q.jsx)(Re,{})}),i.length>0&&(0,q.jsx)(V,{variant:"danger",onClick:()=>f(!0),className:"w-full py-1",children:"Clear All Desired Modifiers"}),i.length>0?(0,q.jsxs)("div",{className:"border border-slate-700 rounded-lg p-4 mb-6",children:[(0,q.jsxs)("h3",{className:"font-semibold text-base text-amber-400 border-l-4 border-amber-400 pl-2 mb-4",children:["Desired Modifiers (",g,")"]}),(0,q.jsx)("ul",{className:"max-h-60 overflow-y-auto space-y-2 pr-1 minimal-scrollbar",children:i.map(((e,t)=>(0,q.jsx)(De,{mod:e,index:t,onRemove:y},`${e.id}-${t}`)))})]}):(0,q.jsx)("div",{className:"text-slate-400 text-center p-6 border border-dashed border-slate-700 rounded-lg",children:"No modifiers selected. Add modifiers to generate idols."}),(0,q.jsx)(V,{variant:0===i.length?"disabled":"amber",onClick:N,disabled:0===i.length,className:"w-full py-3",children:"Generate & Place Idols"}),i.length>0&&(0,q.jsx)("div",{className:"mt-2 text-xs text-slate-400 text-center",children:"This will create idols with these modifiers and place them on the grid"}),(0,q.jsxs)("div",{className:"mb-4",children:[(0,q.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,q.jsx)("h3",{className:"font-medium text-base text-slate-300 border-l-4 border-slate-600 pl-2",children:"Search Modifiers"}),l&&(0,q.jsx)("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-slate-300 transition-colors",children:i.length>0?"Hide Search":"\u2715 Close"})]}),l?(0,q.jsx)(Te,{modData:t,onAddModifier:v,onRemoveModifier:j,modifierList:i,initialState:p.current,onSearchUpdate:C,searchContext:"autogen"}):(0,q.jsx)(V,{variant:"secondary",onClick:()=>a(!0),className:"w-full",children:"+ Add Modifier"})]})]}),c&&(0,q.jsx)(Pe,{isOpen:c,onClose:()=>u(!1),title:"Load Modifiers Confirmation",actions:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(V,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),(0,q.jsx)(V,{variant:"amber",onClick:()=>{u(!1),w()},children:"Confirm"})]}),children:(0,q.jsx)("p",{children:"This will extract modifiers from your inventory and add them to the desired modifiers list. When generated, these modifiers will be optimized across idols which could result in different combinations than your original inventory. Some combinations may be more costly to trade for. Do you want to continue?"})}),m&&(0,q.jsx)(Pe,{isOpen:m,onClose:()=>f(!1),title:"Clear All Modifiers",actions:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(V,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),(0,q.jsx)(V,{variant:"red",onClick:k,children:"Confirm"})]}),children:(0,q.jsx)("p",{children:"Are you sure you want to clear all desired modifiers?"})})]})},Fe=e=>{let{error:t}=e;return(0,q.jsx)("div",{className:"bg-red-900 bg-opacity-50 p-4 rounded-lg mb-5 border border-red-800",children:(0,q.jsxs)("p",{className:"text-red-200",children:["Error parsing idol: ",t]})})},ze=()=>(0,q.jsx)("div",{className:"mb-5",children:(0,q.jsx)("p",{className:"text-slate-300",children:"Parsing idol text..."})}),Ge=e=>{let{idol:t}=e;return(0,q.jsxs)("div",{className:"mb-5",children:[(0,q.jsx)("p",{className:"mb-3 text-slate-300",children:"Successfully parsed idol:"}),(0,q.jsxs)("div",{className:"bg-slate-800 p-4 rounded-lg",children:[(0,q.jsx)("div",{className:"font-bold text-indigo-300",children:t.name}),(0,q.jsxs)("div",{className:"text-slate-300",children:[t.type," Idol"]}),(0,q.jsx)("div",{className:"mt-3 space-y-3",children:t.isUnique?(0,q.jsx)(_e,{modifiers:t.uniqueModifiers}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(He,{title:"Prefixes",titleColor:"text-blue-400",modifiers:t.prefixes,emptyText:"No prefixes"}),(0,q.jsx)(He,{title:"Suffixes",titleColor:"text-green-400",modifiers:t.suffixes,emptyText:"No suffixes"})]})})]})]})},_e=e=>{let{modifiers:t}=e;return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("div",{className:"text-purple-400 font-semibold",children:"Unique Modifiers:"}),(null===t||void 0===t?void 0:t.length)>0?(0,q.jsx)("ul",{className:"list-disc list-inside text-sm text-slate-300 space-y-1",children:t.map(((e,t)=>(0,q.jsx)("li",{children:e.Mod},`unique-mod-${t}`)))}):(0,q.jsx)("div",{className:"text-slate-400 text-sm",children:"No modifiers found"})]})},He=e=>{let{title:t,titleColor:s,modifiers:r,emptyText:i}=e;return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:`${s} font-semibold`,children:[t,":"]}),(null===r||void 0===r?void 0:r.length)>0?(0,q.jsx)("ul",{className:"list-disc list-inside text-sm text-slate-300 space-y-1",children:r.map(((e,s)=>(0,q.jsx)("li",{children:e.Mod},`${t.toLowerCase()}-${s}`)))}):(0,q.jsx)("div",{className:"text-slate-400 text-sm",children:i})]})},Ve=e=>{let{onAddIdol:t,modData:s}=e;const[i,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),c=(0,r.useMemo)((()=>{if(null===s||void 0===s||!s.prefixes||null===s||void 0===s||!s.suffixes)return{allPrefixes:[],allSuffixes:[],allMods:[]};const e=Object.values(s.prefixes).flat(),t=Object.values(s.suffixes).flat();return{allPrefixes:e,allSuffixes:t,allMods:[...e,...t]}}),[s]),u=(0,r.useCallback)((()=>`${Date.now()}-${Math.random()}`),[]),m=(0,r.useCallback)((e=>{const{allMods:t}=c;if(!t.length)return[];const s=[];let r="",i=0;for(;i<e.length;){const n=e[i].trim();if(""===r){r=n,i++;continue}const l=r+" "+n,a=t.some((e=>me(e.Mod,l))),o=r,d=t.some((e=>me(e.Mod,o))),c=/^[A-Z]/.test(n)||n.includes("your Maps")||n.includes("Maps")||n.match(/^\d+%/)||n.includes("chance to");if(a)r=l,i++;else if(d&&c)s.push(r),r=n,i++;else{let l=!1;for(let s=1;s<=3&&i+s-1<e.length;s++){const n=r+" "+e.slice(i,i+s).join(" ");if(t.some((e=>me(e.Mod,n)))){r=n,i+=s,l=!0;break}}l||(c?(s.push(r),r=n):r+=" "+n,i++)}}return r&&s.push(r),s}),[c]),f=(0,r.useCallback)(((e,t,s)=>{const r=[];if(-1!==t&&-1!==s){let i="";for(let n=t;n<s;n++){const t=e[n].trim();t&&!t.includes("(implicit)")&&(i&&(/^[A-Z0-9]/.test(t)||/^\(/.test(t))?(r.push({Mod:i,Name:"Unique",id:`unique-${u()}`}),i=t):i=i?`${i} ${t}`:t)}i&&r.push({Mod:i,Name:"Unique",id:`unique-${u()}`})}return r}),[u]),x=(0,r.useCallback)((e=>{const{allPrefixes:t,allSuffixes:s}=c,r=[],i=[];for(const n of e){if(!n)continue;let e=!1;for(const s of t)if(me(s.Mod,n)){r.push({...s,Mod:n}),e=!0;break}if(!e)for(const t of s)if(me(t.Mod,n)){i.push({...t,Mod:n}),e=!0;break}e||("prefix"===fe(n)?r.push({Name:"Unknown Prefix",Mod:n,id:`unknown-${u()}`}):i.push({Name:"Unknown Suffix",Mod:n,id:`unknown-${u()}`}))}return{prefixes:r,suffixes:i}}),[c,u]),h=(0,r.useCallback)((e=>{try{const t=e.split("\n").filter((e=>""!==e.trim()));if(!t.some((e=>e.includes("Item Class: Idols"))))return{success:!1,error:"Not an idol item"};let s="",r="",i=0,n="";const l=t.find((e=>e.startsWith("Rarity:")));n=l?l.replace("Rarity: ","").trim():"";const a=t.findIndex((e=>e.startsWith("Rarity:")));if(a>=0&&a+1<t.length&&(s=t[a+1].trim()),a>=0&&a+2<t.length){const e=t[a+2].trim();e.includes("Idol")&&(r=e.split(" ")[0])}if("magic"===n.toLowerCase()&&s){const e=s.match(/(\w+)\s+Idol/i);e&&e[1]&&(r=e[1])}const o=t.find((e=>e.includes("Item Level:")));if(o){const e=o.match(/Item Level: (\d+)/);e&&e[1]&&(i=parseInt(e[1],10))}const d=t.map(((e,t)=>"--------"===e.trim()?t:-1)).filter((e=>-1!==e));if("unique"===n.toLowerCase()){let e=-1,n=-1;for(let s=0;s<d.length-1;s++)if(t.slice(d[s]+1,d[s+1]).some((e=>e.includes("(implicit)")))){e=d[s+1]+1;break}if(-1===e)for(let s=0;s<d.length-1;s++)if(t.slice(d[s]+1,d[s+1]).some((e=>e.includes("Item Level:")))){e=d[s+1]+1;break}for(let t=0;t<d.length-1;t++)if(-1!==e&&d[t]>e){n=d[t];break}return{success:!0,idol:{type:r,name:s,isUnique:!0,uniqueModifiers:f(t,e,n),uniqueName:s,prefixes:[],suffixes:[],id:u(),itemLevel:i}}}let c=-1,h=-1;d.length>=4&&(c=d[2]+1,h=d[3]);const p=[];if(-1!==c&&-1!==h)for(let e=c;e<h;e++){const s=t[e].trim();s&&!s.includes("(implicit)")&&p.push(s)}const g=m(p),{prefixes:b,suffixes:v}=x(g);return{success:!0,idol:{type:r,name:s,prefixes:b,suffixes:v,id:u(),isUnique:!1,itemLevel:i,isMagic:"magic"===n.toLowerCase()}}}catch(t){return{success:!1,error:t.message}}}),[m,f,x,u]),p=(0,r.useCallback)((e=>{const t=e.target,s="INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||t.isContentEditable,r=t.closest('[contenteditable="true"]'),i=e.clipboardData.getData("text");if(i.trim().toLowerCase().includes("item class: idols")){e.preventDefault(),e.stopPropagation();const t=h(i);t.success?(d(t.idol),a(null)):(d(null),a(t.error)),n(!0)}else if(s||r)return}),[h]);(0,r.useEffect)((()=>(document.addEventListener("paste",p,!0),()=>document.removeEventListener("paste",p,!0))),[p]);const g=(0,r.useCallback)((()=>{o&&(t(o),n(!1),d(null))}),[o,t]),b=(0,r.useCallback)((()=>n(!1)),[]);return i?(0,q.jsxs)(Pe,{isOpen:i,onClose:b,title:"Idol Detected",children:[l?(0,q.jsx)(Fe,{error:l}):o?(0,q.jsx)(Ge,{idol:o}):(0,q.jsx)(ze,{}),(0,q.jsxs)("div",{className:"flex space-x-4 justify-end",children:[(0,q.jsx)(V,{variant:"secondary",onClick:b,children:"Cancel"}),(0,q.jsx)(V,{variant:"primary",onClick:g,disabled:!o,children:"Add to Inventory"})]})]}):null},Ke=()=>(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),We=e=>{let{message:t}=e;return(0,q.jsx)("div",{className:"absolute left-1/2 -translate-x-1/2 top-full mt-2 p-2 bg-slate-800 text-white text-xs rounded-md shadow-lg z-10 whitespace-nowrap border border-slate-700",children:t})},Ye=e=>{let{gridState:t,inventory:s}=e;const[i,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),o=(0,r.useCallback)((async()=>{a(!0);try{const e=j(t,s);await(async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(t){return console.error("Failed to copy to clipboard:",t),!1}})(e),n(!0),setTimeout((()=>n(!1)),3e3)}catch(e){console.error("Failed to share layout:",e)}finally{a(!1)}}),[t,s]),d=(0,r.useMemo)((()=>l?"Copying...":"Share Layout"),[l]);return(0,q.jsxs)("div",{className:"relative",children:[(0,q.jsxs)(V,{variant:"blue",onClick:o,disabled:l,title:"Share your idol layout with a link",className:"flex items-center gap-2",children:[(0,q.jsx)(Ke,{}),d]}),i&&(0,q.jsx)(We,{message:"Link copied to clipboard"})]})},Je=r.memo(Ye),Xe=e=>{let{onClear:t}=e;const[s,i]=(0,r.useState)(!1),n=(0,r.useCallback)((()=>{i(!0)}),[]),l=(0,r.useCallback)((()=>{i(!1)}),[]),a=(0,r.useCallback)((()=>{(()=>{try{return localStorage.removeItem(u),localStorage.removeItem(m),!0}catch(e){return console.error("Failed to clear data:",e),!1}})(),t(),i(!1)}),[t]);return(0,q.jsxs)("div",{className:"relative",children:[(0,q.jsxs)(V,{variant:"danger",onClick:n,title:"Clear all idols and grid layout",className:"flex items-center gap-2",children:[(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Clear All"]}),s&&(0,q.jsxs)("div",{className:"absolute right-0 mt-2 p-4 bg-slate-800 border border-slate-700 rounded-lg shadow-lg z-10 w-72",children:[(0,q.jsx)("p",{className:"text-sm mb-4 text-slate-300",children:"Are you sure you want to clear all idols and grid layout?"}),(0,q.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,q.jsx)(V,{variant:"secondary",size:"sm",onClick:l,children:"Cancel"}),(0,q.jsx)(V,{variant:"danger",size:"sm",onClick:a,children:"Clear"})]})]})]})},Ze=r.memo(Xe),Qe=()=>(0,q.jsxs)("div",{className:"py-12 text-center text-slate-400",children:[(0,q.jsxs)("svg",{className:"animate-spin h-8 w-8 mx-auto mb-4 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,q.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,q.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading strategies..."]}),et=e=>{let{error:t}=e;return(0,q.jsxs)("div",{className:"py-6 text-center text-red-400 border border-red-900 rounded-lg bg-red-900 bg-opacity-20",children:[t,(0,q.jsx)("div",{className:"mt-3 text-xs",children:"Make sure the file exists at: /data/strategies.json"})]})},tt=e=>{let{hasFilter:t}=e;return(0,q.jsx)("div",{className:"text-center py-12 text-slate-400 border border-dashed border-slate-700 rounded-lg",children:t?"No strategies match your search":"No strategies available"})},st=e=>{let{strategy:t,onLoadStrategy:s}=e;return(0,q.jsxs)("li",{className:"bg-slate-800 rounded-lg p-4 hover:bg-slate-750 transition-colors border border-slate-700 cursor-pointer",onClick:()=>s(t),children:[(0,q.jsxs)("div",{className:"flex justify-between items-start",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"font-bold text-indigo-300",children:t.name}),(0,q.jsxs)("p",{className:"text-sm text-slate-400 mt-1",children:["By: ",t.author]})]}),(0,q.jsx)("button",{className:"bg-indigo-600 hover:bg-indigo-500 text-white text-sm py-1.5 px-3 rounded-md transition-colors shadow-sm",onClick:e=>{e.stopPropagation(),s(t)},children:"Load Strategy"})]}),(0,q.jsx)("p",{className:"text-sm mt-2 text-slate-300",children:t.description}),t.mapdevice&&(0,q.jsxs)("div",{className:"mt-3",children:[(0,q.jsx)("span",{className:"text-sm font-medium text-indigo-300",children:"Map Device:"}),(0,q.jsx)("span",{className:"ml-2 text-sm text-slate-300",children:t.mapdevice})]}),t.scarabs&&t.scarabs.length>0&&(0,q.jsxs)("div",{className:"mt-2",children:[(0,q.jsx)("span",{className:"text-sm font-medium text-indigo-300",children:"Scarabs:"}),(0,q.jsx)("span",{className:"ml-2 text-sm text-slate-300",children:t.scarabs.join(", ")})]}),t.source&&(0,q.jsxs)("div",{className:"mt-2",children:[(0,q.jsx)("span",{className:"text-sm font-medium text-indigo-300",children:"Source:"}),(0,q.jsx)("a",{href:t.source,target:"_blank",rel:"noopener noreferrer",className:"ml-2 text-sm text-indigo-400 hover:text-indigo-300 hover:underline transition-colors",onClick:e=>{e.stopPropagation()},children:"Watch on YouTube"})]}),t.tags&&(0,q.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:t.tags.map((e=>(0,q.jsx)("span",{className:"bg-slate-900 text-slate-300 text-xs px-2 py-1 rounded-full border border-slate-700",children:e},e)))})]})};const rt=function(e){let{onClose:t,onLoadStrategy:s}=e;const[i,n]=(0,r.useState)([]),[l,a]=(0,r.useState)(!0),[o,d]=(0,r.useState)(null),[c,u]=(0,r.useState)("");(0,r.useEffect)((()=>{const e=e=>{"Escape"===e.key&&t()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[t]),(0,r.useEffect)((()=>{(async()=>{try{a(!0);const e="/poe-idol-grid-builder",t=await fetch(`${e}/data/strategies.json`);if(!t.ok)throw new Error(`Failed to load strategies (Status: ${t.status})`);const s=await t.json();n(s),d(null)}catch(e){console.error("Error loading strategies:",e),d(`Failed to load strategies. ${e.message}`)}finally{a(!1)}})()}),[]);const m=(0,r.useMemo)((()=>{if(!c)return i;const e=c.toLowerCase();return i.filter((t=>t.name.toLowerCase().includes(e)||t.author.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.tags&&t.tags.some((t=>t.toLowerCase().includes(e)))||t.mapdevice&&t.mapdevice.toLowerCase().includes(e)||t.scarabs&&t.scarabs.some((t=>t.toLowerCase().includes(e)))))}),[i,c]),f=(0,r.useCallback)((e=>{s(e.shareUrl),t()}),[s,t]);return(0,q.jsx)("div",{className:"fixed inset-0 bg-slate-950 bg-opacity-80 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:(0,q.jsxs)("div",{className:"bg-slate-900 rounded-xl p-6 max-w-2xl w-full shadow-lg border border-slate-800 max-h-[90vh] flex flex-col",children:[(0,q.jsxs)("div",{className:"flex justify-between items-start mb-5",children:[(0,q.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Community Strategies"}),(0,q.jsx)("button",{onClick:t,className:"text-slate-400 hover:text-white transition-colors","aria-label":"Close",children:"\u2715"})]}),(0,q.jsx)("div",{className:"mb-5",children:(0,q.jsx)("input",{type:"text",placeholder:"Search by name, author, description, tags...",className:"w-full bg-slate-800 p-3 rounded-lg border border-slate-700 text-slate-200 placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all",value:c,onChange:e=>u(e.target.value)})}),(0,q.jsx)("div",{className:"flex-grow overflow-y-auto pr-1 minimal-scrollbar",children:l?(0,q.jsx)(Qe,{}):o?(0,q.jsx)(et,{error:o}):m.length>0?(0,q.jsx)("ul",{className:"space-y-4",children:m.map((e=>(0,q.jsx)(st,{strategy:e,onLoadStrategy:f},e.id)))}):(0,q.jsx)(tt,{hasFilter:!!c})}),(0,q.jsx)("div",{className:"mt-6 pt-4 border-t border-slate-800",children:(0,q.jsx)("p",{className:"text-sm text-slate-400",children:"These are community strategies for Path of Exile mapping. Click on a strategy to load its idol configuration."})})]})})},it=(0,r.memo)((function(e){let{onLoadStrategy:t}=e;const[s,i]=(0,r.useState)(!1);return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("button",{className:"bg-amber-600 hover:bg-amber-500 text-white py-2 px-4 rounded-lg text-sm font-medium flex items-center gap-2 shadow-sm transition-colors",onClick:()=>i(!0),title:"Load community strategies",children:[(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Strategies"]}),s&&(0,q.jsx)(rt,{onClose:()=>i(!1),onLoadStrategy:t})]})}));const nt=()=>(0,q.jsxs)("div",{className:"bg-slate-900 p-6 rounded-xl shadow-sm",children:[(0,q.jsx)("h2",{className:"text-xl font-bold mb-6 text-white",children:"Unique Idols"}),(0,q.jsxs)("div",{className:"py-12 text-center text-slate-400",children:[(0,q.jsxs)("svg",{className:"animate-spin h-8 w-8 mx-auto mb-4 text-pink-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,q.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,q.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading unique idols..."]})]}),lt=e=>{let{error:t}=e;return(0,q.jsxs)("div",{className:"bg-slate-900 p-6 rounded-xl shadow-sm",children:[(0,q.jsx)("h2",{className:"text-xl font-bold mb-6 text-white",children:"Unique Idols"}),(0,q.jsx)("div",{className:"py-6 text-center text-red-400 border border-red-900 rounded-lg bg-red-900 bg-opacity-20",children:t})]})},at=e=>{let{searchTerm:t,setSearchTerm:s}=e;return(0,q.jsxs)("div",{className:"mb-6 relative",children:[(0,q.jsx)("input",{type:"text",placeholder:"Search unique idols...",className:"w-full bg-slate-800 py-2.5 px-3 pr-8 rounded-md text-sm border border-slate-700 focus:ring-1 focus:ring-pink-500 focus:border-pink-500 outline-none",value:t,onChange:e=>s(e.target.value)}),(0,q.jsx)("div",{className:"absolute right-3 top-2.5 text-slate-500",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})},ot=e=>{let{idols:t,isIdolInInventory:s,handleAddIdol:r,handleTradeClick:i}=e;return(0,q.jsx)("div",{className:"space-y-4",children:t.map((e=>(0,q.jsx)(dt,{idol:e,isInInventory:s(e.name),onAddIdol:r,onTradeClick:i},e.id)))})},dt=e=>{let{idol:t,isInInventory:s,onAddIdol:r,onTradeClick:i}=e;return(0,q.jsxs)("div",{className:"bg-gradient-to-r from-pink-700/30 to-pink-800/40 border border-pink-600 p-6 rounded-lg shadow-md transition-all hover:shadow-lg",children:[(0,q.jsxs)("div",{className:"flex justify-between items-start",children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("h3",{className:"font-extrabold text-base text-white",children:t.name}),(0,q.jsx)("p",{className:"text-xs text-pink-300 mt-1",children:t.fullType})]}),(0,q.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,q.jsx)("button",{onClick:()=>i(t),className:"bg-indigo-600 hover:bg-indigo-500 border border-indigo-500 text-white text-xs py-1.5 px-2.5 rounded transition-colors",title:"Search for this unique idol on the trade site",children:"Trade"}),(0,q.jsx)("button",{onClick:()=>r(t),className:"text-xs py-1.5 px-2.5 rounded transition-colors border "+(s?"bg-slate-700 text-slate-400 border-slate-600 cursor-not-allowed":"bg-green-600 hover:bg-green-500 text-white border-green-500"),disabled:s,title:s?"Already added to inventory":"Add to inventory",children:s?"Added":"Add"})]})]}),(0,q.jsxs)("div",{className:"mt-4",children:[(0,q.jsx)("h4",{className:"text-xs font-medium text-pink-400 border-l-4 border-pink-400 pl-2 mb-2",children:"Unique Modifiers:"}),(0,q.jsx)("ul",{className:"space-y-1.5 mt-2",children:t.uniqueModifiers.map(((e,t)=>(0,q.jsx)("li",{className:"text-[11px] text-slate-300 pl-3",children:e.Mod},t)))})]})]})},ct=e=>{let{searchTerm:t}=e;return(0,q.jsx)("div",{className:"text-center py-12 text-slate-400 border border-dashed border-slate-700 rounded-lg",children:t?"No unique idols match your search":"No unique idols available"})},ut=function(e){let{onAddIdol:t,inventory:s}=e;const[i,n]=(0,r.useState)([]),[l,a]=(0,r.useState)(!0),[o,d]=(0,r.useState)(null),[c,u]=(0,r.useState)("");(0,r.useEffect)((()=>{(async()=>{try{a(!0);const e="/poe-idol-grid-builder",t=await fetch(`${e}/data/unique_idol_mods.json`);if(!t.ok)throw new Error("Failed to load unique idols");const s=(await t.json()).map((e=>({id:e.id||`unique-${Date.now()}-${Math.random()}`,name:e.Item,type:e.Type.split(" ")[0],fullType:e.Type,isUnique:!0,uniqueModifiers:e.Mods.map((e=>({Mod:e,Name:"Unique",Code:`Unique-${Date.now()}-${Math.random()}`})))})));n(s),d(null)}catch(e){console.error("Error loading unique idols:",e),d("Failed to load unique idols. Please try again later.")}finally{a(!1)}})()}),[]);const m=(0,r.useMemo)((()=>i.filter((e=>""===c||e.name.toLowerCase().includes(c.toLowerCase())||e.type.toLowerCase().includes(c.toLowerCase())||e.uniqueModifiers.some((e=>e.Mod.toLowerCase().includes(c.toLowerCase())))))),[i,c]),f=(0,r.useCallback)((e=>!!s&&s.some((t=>t.isUnique&&t.name===e))),[s]),x=(0,r.useCallback)((e=>{t({...e,id:`${e.id}-${Date.now()}`})}),[t]),h=(0,r.useCallback)((e=>{const t=Z({isUnique:!0,name:e.name,uniqueName:e.name,type:e.type});t&&window.open(t,"_blank")}),[]);return l?(0,q.jsx)(nt,{}):o?(0,q.jsx)(lt,{error:o}):(0,q.jsxs)("div",{className:"bg-slate-900 p-6 rounded-xl shadow-sm",children:[(0,q.jsx)("h2",{className:"text-xl font-bold mb-6 text-white",children:"Unique Idols"}),(0,q.jsx)(at,{searchTerm:c,setSearchTerm:u}),(0,q.jsx)("div",{className:"max-h-96 overflow-y-auto pr-1 minimal-scrollbar",children:m.length>0?(0,q.jsx)(ot,{idols:m,isIdolInInventory:f,handleAddIdol:x,handleTradeClick:h}):(0,q.jsx)(ct,{searchTerm:c})})]})},mt=[{label:"Minor (1\xd71)",value:"Minor"},{label:"Kamasan (1\xd72) \u2022 Noble (2\xd71)",value:"KamasanNoble"},{label:"Totemic (1\xd73) \u2022 Burial (3\xd71)",value:"TotemicBurial"},{label:"Conqueror (2\xd72)",value:"Conqueror"}],ft={KamasanNoble:["Kamasan","Noble"],TotemicBurial:["Totemic","Burial"]},xt=e=>{let{modData:t,idolTypes:s}=e;const[i,n]=(0,r.useState)(""),[l,a]=(0,r.useState)([]),[o,d]=(0,r.useState)([]),[c,u]=(0,r.useState)(null),[m,f]=(0,r.useState)(null),[x,h]=(0,r.useState)({searchTerm:"",filterType:"all",viewByName:!1,selectedNames:[]}),p=(0,r.useMemo)((()=>"KamasanNoble"===i||"TotemicBurial"===i),[i]),g=(0,r.useMemo)((()=>ft[i]||[]),[i]);(0,r.useEffect)((()=>{a([]),d([]),u(null)}),[i]),(0,r.useEffect)((()=>()=>{m&&clearTimeout(m)}),[m]);const b=(0,r.useCallback)((e=>{u(e);const t=setTimeout((()=>u(null)),5e3);return f(t),t}),[]),v=(0,r.useCallback)((()=>{u(null),m&&(clearTimeout(m),f(null))}),[m]),y=(0,r.useMemo)((()=>i&&t.prefixes&&t.suffixes?"KamasanNoble"===i?{prefixes:{KamasanNoble:t.prefixes.Kamasan||[]},suffixes:{KamasanNoble:t.suffixes.Kamasan||[]}}:"TotemicBurial"===i?{prefixes:{TotemicBurial:t.prefixes.Burial||[]},suffixes:{TotemicBurial:t.suffixes.Burial||[]}}:{prefixes:{[i]:t.prefixes[i]||[]},suffixes:{[i]:t.suffixes[i]||[]}}:{prefixes:{},suffixes:{}}),[i,t.prefixes,t.suffixes]),j=(0,r.useCallback)(((e,t)=>{v(),"prefix"===t?a((t=>t.some((t=>t.id===e.id))?t:[...t,e])):"suffix"===t&&d((t=>t.some((t=>t.id===e.id))?t:[...t,e]))}),[v]),w=(0,r.useCallback)((e=>{"prefix"===e.type?a((t=>t.filter((t=>t.id!==e.id)))):d((t=>t.filter((t=>t.id!==e.id)))),v()}),[v]),N=(0,r.useCallback)((e=>{a((t=>t.filter(((t,s)=>s!==e)))),v()}),[v]),C=(0,r.useCallback)((e=>{d((t=>t.filter(((t,s)=>s!==e)))),v()}),[v]),k=(0,r.useCallback)((function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||i;if(!e)return;const t=((e,t,s)=>{if(!e||(null===t||void 0===t||!t.length)&&(null===s||void 0===s||!s.length))return"";const r=[],i=[];if((null===t||void 0===t?void 0:t.length)>0&&t.forEach((e=>{e.trade&&r.push({id:e.trade})})),(null===s||void 0===s?void 0:s.length)>0&&s.forEach((e=>{e.trade&&i.push({id:e.trade})})),0===r.length&&0===i.length)return"";const n=[{type:"and",filters:[],disabled:!1}];r.length>0&&n.push({type:"count",value:{min:1},filters:r}),i.length>0&&n.push({type:"count",value:{min:1},filters:i});const l={query:{type:`${e} Idol`,stats:n,status:{option:"online"},filters:{type_filters:{filters:{category:{option:"idol"}}}}}};return`https://www.pathofexile.com/trade/search/Phrecia?q=${encodeURIComponent(JSON.stringify(l))}`})(e,l,o);t?window.open(t,"_blank"):b("Failed to generate trade URL. Please select at least one modifier.")}),[i,l,o,b]),M=(e,t,s)=>{if(0===e.length)return(0,q.jsxs)("div",{className:"p-4 bg-slate-800 rounded-md text-sm text-slate-400 text-center mb-4 ring-1 ring-slate-700",children:["No ",t,"s selected"]});const r="prefix"===t?"text-blue-400":"text-green-400";return(0,q.jsx)("ul",{className:"mb-4 space-y-2 max-h-48 overflow-y-auto minimal-scrollbar pr-1",children:e.map(((e,i)=>(0,q.jsxs)("li",{className:"bg-slate-800 p-3 rounded-md flex justify-between ring-1 ring-slate-700",onContextMenu:e=>{e.preventDefault(),s(i)},children:[(0,q.jsxs)("div",{children:[(0,q.jsx)("div",{className:`text-sm font-medium ${r}`,children:e.Name}),(0,q.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:e.Mod})]}),(0,q.jsx)("button",{onClick:()=>s(i),className:"text-slate-400 hover:text-slate-300 ml-2 self-start",title:`Remove ${t}`,children:"\u2715"})]},i)))})};return(0,q.jsxs)("div",{className:"bg-slate-900 p-5 rounded-xl shadow-sm",children:[(0,q.jsx)("h2",{className:"text-xl font-bold mb-1 text-white",children:"Generate Trade"}),(0,q.jsx)("p",{className:"text-sm text-slate-400 mb-4",children:'Input any combination of prefixes and suffixes to generate a trade URL that includes the selected prefix and suffix modifiers, with their counts configurable under the "Show Filters" section on the Path of Exile trade site.'}),(0,q.jsxs)("div",{className:"space-y-5",children:[c?(0,q.jsx)("div",{className:"bg-red-900/50 p-3 rounded-lg border border-red-800 text-red-200 text-sm",children:c}):null,(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"block mb-2 text-sm text-slate-300",children:"Idol Type"}),(0,q.jsxs)("select",{className:"w-full bg-slate-800 p-3 rounded-md border-0 text-sm ring-1 ring-slate-700 focus:ring-2 focus:ring-indigo-500 outline-none",value:i,onChange:e=>n(e.target.value),children:[(0,q.jsx)("option",{value:"",children:"Select Idol Type"}),mt.map((e=>(0,q.jsx)("option",{value:e.value,children:e.label},e.value)))]})]}),i&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsxs)("h3",{className:"font-medium mb-2 text-sm text-slate-300",children:["Selected Prefixes (",l.length,")"]}),M(l,"prefix",N)]}),(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsxs)("h3",{className:"font-medium mb-2 text-sm text-slate-300",children:["Selected Suffixes (",o.length,")"]}),M(o,"suffix",C)]}),(0,q.jsxs)("div",{className:"border-t border-slate-800 pt-4",children:[(0,q.jsx)("h3",{className:"font-medium mb-2 text-sm text-slate-300",children:"Search & Add Modifiers"}),(0,q.jsx)(Te,{modData:y,onAddModifier:j,onRemoveModifier:w,selectedType:i,initialState:x,onSearchUpdate:h,searchContext:"trade",selectedPrefixes:l,selectedSuffixes:o})]}),p?(0,q.jsx)("div",{className:"grid grid-cols-2 gap-4 mt-4",children:g.map((e=>(0,q.jsxs)("button",{className:"py-3 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-md font-medium transition-colors",onClick:()=>k(e),disabled:0===l.length&&0===o.length,children:["Trade for ",e]},e)))}):(0,q.jsx)("button",{className:"w-full mt-4 py-3 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-md font-medium transition-colors",onClick:()=>k(),disabled:!i||0===l.length&&0===o.length,children:"Trade for Modifiers"})]})]})]})},ht=r.memo(xt);const pt=()=>(0,q.jsx)("div",{className:"flex items-center justify-center h-screen bg-slate-950 text-white",children:(0,q.jsxs)("div",{className:"text-center",children:[(0,q.jsxs)("svg",{className:"animate-spin h-12 w-12 mx-auto mb-4 text-indigo-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,q.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,q.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,q.jsx)("p",{className:"text-xl",children:"Loading idol data..."})]})}),gt=e=>{let{onLoadStrategy:t,gridState:s,inventory:r,onOptimize:i,onClear:n}=e;return(0,q.jsxs)("header",{className:"mb-6",children:[(0,q.jsx)("h1",{className:"text-3xl font-bold text-center text-amber-400",children:"Path of Exile Idol Grid Builder"}),(0,q.jsx)("div",{className:"w-full h-px bg-slate-700 my-4"}),(0,q.jsxs)("div",{className:"flex flex-wrap justify-center mt-3 space-x-0 sm:space-x-4 gap-2 sm:gap-0 px-2 sm:px-0",children:[(0,q.jsx)(it,{onLoadStrategy:t}),(0,q.jsx)(Je,{gridState:s,inventory:r}),(0,q.jsx)(J,{onOptimize:i}),(0,q.jsx)(Ze,{onClear:n})]})]})},bt=e=>{let{activeTab:t,setActiveTab:s}=e;return(0,q.jsxs)("div",{className:"flex flex-wrap md:hidden border-b border-slate-700 mb-4",children:[(0,q.jsx)(vt,{active:"builder"===t,onClick:()=>s("builder"),children:"Builder"}),(0,q.jsx)(vt,{active:"inventory"===t,onClick:()=>s("inventory"),children:"Inventory"}),(0,q.jsx)(vt,{active:"modifiers"===t,onClick:()=>s("modifiers"),children:"Mods"}),(0,q.jsx)(vt,{active:"autogen"===t,onClick:()=>s("autogen"),children:"Auto"}),(0,q.jsx)(vt,{active:"unique"===t,onClick:()=>s("unique"),children:"Unique"}),(0,q.jsx)(vt,{active:"trade"===t,onClick:()=>s("trade"),children:"Trade"})]})},vt=e=>{let{active:t,onClick:s,children:r}=e;return(0,q.jsx)("button",{className:"flex-1 py-2 px-2 "+(t?"border-b-2 border-amber-400 text-amber-400":"text-slate-400"),onClick:s,children:r})},yt=e=>{let{activeTab:t,setActiveTab:s}=e;return(0,q.jsx)("div",{className:"hidden md:block mb-6",children:(0,q.jsxs)("div",{className:"bg-slate-800 rounded-lg overflow-hidden flex flex-wrap w-full",children:[(0,q.jsx)(jt,{active:"builder"===t,onClick:()=>s("builder"),minWidth:"min-w-[120px]",children:"Manual Builder"}),(0,q.jsx)(jt,{active:"autogen"===t,onClick:()=>s("autogen"),minWidth:"min-w-[120px]",children:"Auto-Generate"}),(0,q.jsx)(jt,{active:"unique"===t,onClick:()=>s("unique"),minWidth:"min-w-[100px]",children:"Unique Idols"}),(0,q.jsx)(jt,{active:"trade"===t,onClick:()=>s("trade"),minWidth:"min-w-[100px]",children:"Generate Trade"})]})})},jt=e=>{let{active:t,onClick:s,children:r,minWidth:i}=e;return(0,q.jsx)("button",{className:`py-2.5 px-4 ${i} flex-grow ${t?"bg-indigo-600 text-white font-medium":"hover:bg-slate-700 text-slate-300"} transition-colors focus:ring-2 focus:ring-indigo-500 focus:outline-none`,onClick:s,children:r})},wt=e=>{let{result:t,onClose:s}=e;if(!t)return null;const r=t.error,i=t.notPlaced&&t.notPlaced.length>0,n=r?"bg-red-900/50 border border-red-800":i?"bg-amber-900/30 border border-amber-800":"bg-green-900/30 border border-green-800";return(0,q.jsxs)("div",{className:`mb-4 p-3 rounded-lg ${n}`,children:[(0,q.jsxs)("div",{className:"flex justify-between",children:[(0,q.jsx)("h3",{className:"font-medium text-white",children:"Generation Results"}),(0,q.jsx)("button",{onClick:s,className:"text-slate-300 hover:text-white transition-colors",children:"\u2715"})]}),r?(0,q.jsx)("p",{className:"text-sm text-red-200 mt-1",children:t.error}):t.message?(0,q.jsx)("p",{className:"text-sm text-green-200 mt-1",children:t.message}):(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("p",{className:"text-sm text-slate-300 mt-1",children:["Created ",t.total," idols with ",t.modifiersRequested," desired modifiers."," ",t.placed," idols were automatically placed on the grid."]}),i&&(0,q.jsxs)("div",{className:"mt-2 bg-slate-800/50 p-2 rounded-md",children:[(0,q.jsxs)("p",{className:"text-sm text-amber-300",children:[t.notPlaced.length," ",1===t.notPlaced.length?"idol":"idols"," ","couldn't be placed:"]}),(0,q.jsx)("ul",{className:"mt-1 ml-4 list-disc text-xs text-slate-300",children:t.notPlaced.map(((e,t)=>(0,q.jsxs)("li",{children:[e.name," - No suitable space on grid"]},t)))})]})]})]})},Nt=e=>{let{onDismiss:t}=e;return(0,q.jsxs)("div",{className:"bg-slate-800/80 text-sm py-2 px-4 rounded-lg mb-4 flex justify-between items-center border-l-4 border-indigo-500",children:[(0,q.jsxs)("span",{className:"text-slate-300",children:[(0,q.jsx)("span",{className:"font-bold text-indigo-400",children:"Pro Tip:"})," Press"," ",(0,q.jsx)("kbd",{className:"bg-slate-700 px-1.5 py-0.5 rounded text-xs",children:"Ctrl+V"})," ","to paste idols directly from Path of Exile"]}),(0,q.jsx)("button",{onClick:t,className:"text-slate-400 hover:text-slate-300 ml-3","aria-label":"Dismiss tip",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,q.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},Ct=()=>(0,q.jsxs)("div",{className:"bg-slate-800/50 rounded-xl p-6 text-center border border-slate-700/50",children:[(0,q.jsx)("div",{className:"flex justify-center mb-4",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-slate-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,q.jsx)("p",{className:"text-slate-300 text-base mb-5",children:"No matching idols found."})]}),kt=e=>{let{value:t,onChange:s}=e;return(0,q.jsxs)("div",{className:"mt-4 relative",children:[(0,q.jsx)("input",{type:"text",placeholder:"Search idols...",className:"w-full bg-slate-800 py-2.5 px-3 pr-8 rounded-md text-sm border border-slate-700 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 outline-none",value:t,onChange:e=>s(e.target.value)}),(0,q.jsx)("div",{className:"absolute right-3 top-2.5 text-slate-500",children:(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})},Mt=()=>(0,q.jsxs)("div",{className:"mt-2 text-xs text-slate-400 flex items-center",children:[(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1 text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Copy an idol from Path of Exile and press Ctrl+V to add it"]}),St=()=>(0,q.jsx)("footer",{className:"mt-auto pt-3 pb-2 border-t border-slate-800 text-center text-sm text-slate-500",children:(0,q.jsx)("div",{className:"max-w-4xl mx-auto flex flex-col items-center",children:(0,q.jsxs)("a",{href:"https://github.com/Jlepoff/poe-idol-grid-builder/issues",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center hover:text-indigo-400 transition-colors focus:ring-2 focus:ring-indigo-500 focus:outline-none mb-1",children:[(0,q.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,q.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Report Issues Here"]})})});function Tt(){const{modData:e,idolTypes:t,inventory:s,gridState:l,isLoading:a,activeTab:o,generationResult:d,firstVisit:c,inventorySearchTerm:u,setActiveTab:m,setGenerationResult:f,setFirstVisit:x,setInventorySearchTerm:h,handleAddIdol:p,handleRemoveIdol:g,handlePlaceIdol:b,handleRemoveFromGrid:v,handleClearAll:y,handleOptimizeGrid:j,handleGenerateIdols:w,handleLoadStrategy:N}=(0,r.useContext)(A),C=(0,r.useMemo)((()=>{if(!u)return s;const e=u.toLowerCase();return s.filter((t=>{var s,r,i;if(t.name.toLowerCase().includes(e)||t.type.toLowerCase().includes(e)||t.isUnique&&"unique".includes(e))return!0;if((null===(s=t.prefixes)||void 0===s?void 0:s.length)>0)for(const n of t.prefixes)if(n.Name.toLowerCase().includes(e)||n.Mod.toLowerCase().includes(e))return!0;if((null===(r=t.suffixes)||void 0===r?void 0:r.length)>0)for(const n of t.suffixes)if(n.Name.toLowerCase().includes(e)||n.Mod.toLowerCase().includes(e))return!0;if(t.isUnique&&(null===(i=t.uniqueModifiers)||void 0===i?void 0:i.length)>0)for(const n of t.uniqueModifiers)if(n.Mod.toLowerCase().includes(e))return!0;return!1}))}),[s,u]);if(a)return(0,q.jsx)(pt,{});const k="builder"===o||"autogen"===o||"unique"===o||"trade"===o;return(0,q.jsx)(i.Q,{backend:n.t2,children:(0,q.jsxs)("div",{className:"min-h-screen bg-slate-950 text-white p-4 flex flex-col",children:[(0,q.jsx)(gt,{onLoadStrategy:N,gridState:l,inventory:s,onOptimize:j,onClear:y}),(0,q.jsx)(bt,{activeTab:o,setActiveTab:m}),d&&(0,q.jsx)(wt,{result:d,onClose:()=>f(null)}),c&&(0,q.jsx)(Nt,{onDismiss:()=>x(!1)}),(0,q.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-10 flex-grow",children:[(0,q.jsxs)("div",{className:"md:col-span-3 lg:col-span-4",children:[(0,q.jsx)(yt,{activeTab:o,setActiveTab:m}),(0,q.jsx)("div",{className:"space-y-6 "+(k?"":"hidden md:block"),children:"autogen"===o?(0,q.jsx)(Oe,{modData:e,onGenerateIdols:w}):"unique"===o?(0,q.jsx)(ut,{onAddIdol:p,inventory:s}):"trade"===o?(0,q.jsx)(ht,{modData:e,idolTypes:t}):(0,q.jsx)(Ee,{modData:e,idolTypes:t,onAddIdol:p})})]}),(0,q.jsxs)("div",{className:"md:col-span-6 lg:col-span-4 flex flex-col items-center",children:[(0,q.jsxs)("div",{className:"bg-slate-900 p-6 rounded-xl shadow-sm w-full",children:[(0,q.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,q.jsx)("h2",{className:"text-xl font-bold text-white",children:"Idol Grid"})}),(0,q.jsx)("div",{className:"flex justify-center items-center max-w-full overflow-x-auto grid-container-parent minimal-scrollbar",children:(0,q.jsx)(z,{gridState:l,onPlaceIdol:b,onRemoveFromGrid:v,idolTypes:t})})]}),(0,q.jsx)("div",{className:"hidden md:block mt-6 w-full",children:(0,q.jsx)(ye,{gridState:l})})]}),(0,q.jsx)("div",{className:`md:col-span-3 lg:col-span-4 space-y-6 ${"inventory"!==o&&"hidden md:block"}`,children:(0,q.jsxs)("div",{className:"bg-slate-900 p-6 rounded-xl shadow-sm",children:[(0,q.jsxs)("div",{className:"mb-6",children:[(0,q.jsxs)("div",{className:"flex justify-between items-center",children:[(0,q.jsx)("h2",{className:"text-xl font-bold text-white",children:"Inventory"}),(0,q.jsxs)("div",{className:"text-sm text-slate-400",children:[C.length," ",1===C.length?"idol":"idols"]})]}),(0,q.jsx)(kt,{value:u,onChange:h}),(0,q.jsx)(Mt,{})]}),0===C.length&&s.length>0?(0,q.jsx)(Ct,{}):(0,q.jsx)(ie,{inventory:C,onRemoveIdol:g})]})}),(0,q.jsx)("div",{className:"col-span-12 "+("modifiers"===o?"md:hidden":"hidden"),children:(0,q.jsx)(ye,{gridState:l})})]}),(0,q.jsx)(St,{}),(0,q.jsx)(Ve,{onAddIdol:p,modData:e})]})})}const It=function(){return(0,q.jsx)(P,{children:(0,q.jsx)(Tt,{})})}}}]);
//# sourceMappingURL=621.470204bb.chunk.js.map